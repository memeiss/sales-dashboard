

<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OMNI - Sales dashboard</title>
<link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css"/>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   DESIGN SYSTEM
   Primary   : #2563EB  (blue  â€“ actions, active state)
   Positive  : #16A34A  (green â€“ up, good)
   Negative  : #DC2626  (red   â€“ down, warning)
   Neutral   : #1E293B  (text)
   Muted     : #64748B
   Surface   : #FFFFFF / #F8FAFC
   Border    : #E2E8F0
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root {
  --blue:    #2563EB;
  --blue-lt: #EFF6FF;
  --green:   #16A34A;
  --green-lt:#F0FDF4;
  --red:     #DC2626;
  --red-lt:  #FEF2F2;
  --amber:   #B45309;
  --amber-lt:#FFFBEB;
  --text:    #1E293B;
  --text2:   #475569;
  --muted:   #94A3B8;
  --bg:      #F1F5F9;
  --surface: #FFFFFF;
  --surface2:#F8FAFC;
  --border:  #E2E8F0;
  --shadow:  0 1px 3px rgba(0,0,0,0.07), 0 1px 2px rgba(0,0,0,0.05);
  --shadow-md: 0 4px 8px rgba(0,0,0,0.08);

  /* Category palette â€“ only used for chart segments */
  --cat1: #2563EB;
  --cat2: #0891B2;
  --cat3: #059669;
  --cat4: #7C3AED;
  --cat5: #EA580C;
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  font-size: 14px;
  -webkit-font-smoothing: antialiased;
}

/* â”€â”€ Upload Banner â”€â”€ */
.upload-banner {
  background: var(--blue);
  position: relative;
}
.upload-banner::after {
  content:'';
  position:absolute;
  inset:0;
  background: linear-gradient(90deg, rgba(0,0,0,0.08) 0%, transparent 60%);
  pointer-events:none;
}
.upload-inner {
  display: flex; align-items: center;
  justify-content: space-between;
  padding: 11px 28px;
  position: relative; z-index:1;
  gap: 16px; flex-wrap: wrap;
}
.upload-left { display: flex; align-items: center; gap: 12px; }
.upload-icon {
  width:34px; height:34px;
  background: rgba(255,255,255,0.18);
  border-radius:8px;
  display:flex; align-items:center; justify-content:center;
  font-size:16px; flex-shrink:0;
}
.upload-text h3 { color:#fff; font-size:13px; font-weight:700; }
.upload-text p  { color:rgba(255,255,255,0.72); font-size:11px; margin-top:1px; }
.upload-right { display:flex; align-items:center; gap:10px; }
.upload-btn {
  display:flex; align-items:center; gap:7px;
  background:#fff; color:var(--blue);
  border:none; padding:8px 16px;
  border-radius:7px; font-size:12px; font-weight:700;
  font-family:inherit; cursor:pointer;
  transition: all 0.18s;
  box-shadow: 0 2px 6px rgba(0,0,0,0.14);
}
.upload-btn:hover { background:#EFF6FF; transform:translateY(-1px); }
.upload-btn svg { width:14px; height:14px; }
.upload-status { color:rgba(255,255,255,0.88); font-size:12px; display:flex; align-items:center; gap:6px; }
.status-dot {
  width:7px; height:7px; border-radius:50%;
  background:#86EFAC; animation:pulse 2s infinite;
}
@keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.5;transform:scale(1.4)} }
#fileInput { display:none; }

/* â”€â”€ Header â”€â”€ */
.header {
  display:flex; align-items:center; justify-content:space-between;
  padding: 12px 28px;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  box-shadow: var(--shadow);
  position:sticky; top:0; z-index:99;
  flex-wrap:wrap; gap:10px;
}
.header-left { display:flex; align-items:center; gap:12px; }
.logo-badge {
  width:36px; height:36px;
  background:var(--blue); border-radius:9px;
  display:flex; align-items:center; justify-content:center;
  font-size:12px; font-weight:800; color:#fff; letter-spacing:-0.5px;
}
.header-title { font-size:15px; font-weight:800; color:var(--text); letter-spacing:-0.3px; }
.header-meta  { font-size:11px; color:var(--muted); margin-top:1px; }
.header-right { display:flex; align-items:center; gap:8px; flex-wrap:wrap; }

/* Period selector */
.period-selector {
  display:flex; align-items:center; gap:5px;
  background:var(--surface2); border:1px solid var(--border);
  border-radius:8px; padding:5px 11px;
}
.period-selector label { font-size:10px; color:var(--muted); font-weight:600; }
.period-selector select {
  border:none; background:transparent;
  font-size:13px; font-weight:700; color:var(--blue);
  font-family:inherit; cursor:pointer; outline:none; padding:0 2px;
}
.period-sep { color:var(--border); }
.period-badge {
  background:var(--blue); color:#fff;
  border-radius:6px; padding:4px 10px;
  font-size:11px; font-weight:700; letter-spacing:0.2px; white-space:nowrap;
}
.live-dot { width:7px;height:7px;background:#4ADE80;border-radius:50%;animation:pulse 2s infinite; }

/* â”€â”€ Nav Tabs â”€â”€ */
.nav-container {
  display:flex; align-items:center; justify-content:center;
  padding:16px 28px 0; gap:12px;
}
.nav-tabs {
  display:flex; background:var(--surface);
  border:1px solid var(--border); border-radius:11px;
  padding:3px; gap:3px; box-shadow:var(--shadow);
}
.nav-tab {
  padding:7px 20px; border-radius:8px;
  font-size:13px; font-weight:600; cursor:pointer;
  color:var(--muted); border:none; background:none;
  font-family:inherit; transition:all 0.18s; white-space:nowrap;
}
.nav-tab:hover { color:var(--blue); background:var(--bg); }
.nav-tab.active { background:var(--blue); color:#fff; font-weight:700; }

/* â”€â”€ Arrow Nav â”€â”€ */
.arrow-nav {
  display:flex; align-items:center; justify-content:space-between;
  padding:12px 28px;
}
.arrow-btn {
  display:flex; align-items:center; gap:6px;
  background:var(--surface); border:1px solid var(--border);
  color:var(--text2); padding:8px 16px; border-radius:8px;
  cursor:pointer; font-size:12px; font-family:inherit; font-weight:600;
  transition:all 0.18s; box-shadow:var(--shadow);
}
.arrow-btn:hover { border-color:var(--blue); color:var(--blue); }
.arrow-btn:disabled { opacity:0.3; cursor:not-allowed; }
.arrow-btn svg { width:15px; height:15px; }
.slide-indicator { display:flex; gap:7px; align-items:center; }
.dot { width:7px;height:7px;border-radius:50%;background:var(--border);transition:all 0.3s;cursor:pointer; }
.dot.active { background:var(--blue);width:22px;border-radius:4px; }

/* â”€â”€ Slides â”€â”€ */
.slides-wrapper {
  overflow: hidden;
  width: 100%;
  position: relative;
}
.slides-track {
  display: flex;
  transition: transform 0.45s cubic-bezier(0.4,0,0.2,1);
  will-change: transform;
}
.slide {
  min-width: 100%;
  width: 100%;
  flex-shrink: 0;
  padding: 0 28px 36px;
  box-sizing: border-box;
  /* ì°¨íŠ¸ê°€ ìŠ¬ë¼ì´ë“œ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ */
  overflow: hidden;
  min-height: 0;
}

/* â”€â”€ Section Title â”€â”€ */
.section-title {
  display:flex; align-items:center; gap:10px;
  margin-bottom:18px; padding-bottom:14px;
  border-bottom:1px solid var(--border);
}
.section-icon { width:36px;height:36px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:16px; }
.section-title h2 { font-size:17px; font-weight:800; letter-spacing:-0.4px; }
.section-title p  { font-size:11px; color:var(--muted); margin-top:2px; }

/* â”€â”€ Grids â”€â”€ */
.grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:12px; }
.grid-3 { display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px; margin-bottom:12px; }
.grid-4 { display:grid; grid-template-columns:repeat(4,1fr); gap:12px; margin-bottom:12px; }
.grid-7 { display:grid; grid-template-columns:repeat(7,1fr); gap:8px; margin-bottom:12px; }

/* â”€â”€ Stat Card â”€â”€ */
.stat-card {
  background:var(--surface); border:1px solid var(--border);
  border-radius:11px; padding:16px;
  box-shadow:var(--shadow); position:relative; overflow:hidden;
  transition: box-shadow 0.18s;
}
.stat-card:hover { box-shadow:var(--shadow-md); }
/* Thin top accent only on explicit modifier classes */
.stat-card.c-blue::before  { content:''; position:absolute; top:0;left:0;right:0;height:3px; background:var(--blue); }
.stat-card.c-green::before { content:''; position:absolute; top:0;left:0;right:0;height:3px; background:var(--green); }
.stat-card.c-red::before   { content:''; position:absolute; top:0;left:0;right:0;height:3px; background:var(--red); }
.stat-card.c-amber::before { content:''; position:absolute; top:0;left:0;right:0;height:3px; background:var(--amber); }

.stat-label {
  font-size:10px; color:var(--muted); font-weight:600;
  letter-spacing:0.4px; text-transform:uppercase; margin-bottom:7px;
}
/* All stat values â†’ black by default */
.stat-value {
  font-size:22px; font-weight:800;
  color:var(--text);
  letter-spacing:-0.5px; line-height:1.2;
  word-break:break-all;
}
.stat-value.sm  { font-size:17px; }
.stat-value.xs  { font-size:14px; }
.stat-value.krw { font-size:16px; font-weight:700; }
/* Only use colored values for directional signals */
.up   { color:var(--green) !important; }
.down { color:var(--red)   !important; }
.hi   { color:var(--blue)  !important; }

.stat-sub { font-size:11px; color:var(--muted); margin-top:6px; display:flex;align-items:center;gap:4px; }
.tag-up   { color:var(--green); font-weight:700; font-size:11px; }
.tag-down { color:var(--red);   font-weight:700; font-size:11px; }

/* â”€â”€ Max/Min card layout â”€â”€ */
.daystat-card {
  background:var(--surface); border:1px solid var(--border);
  border-radius:11px; padding:16px 18px;
  box-shadow:var(--shadow);
  display:flex; align-items:center; gap:14px;
}
.daystat-icon {
  width:38px; height:38px; border-radius:9px; flex-shrink:0;
  display:flex; align-items:center; justify-content:center; font-size:18px;
}
.daystat-icon.max-icon { background:var(--green-lt); }
.daystat-icon.min-icon { background:var(--red-lt); }
.daystat-body { flex:1; min-width:0; }
.daystat-label { font-size:10px; color:var(--muted); font-weight:600; text-transform:uppercase; letter-spacing:0.4px; margin-bottom:4px; }
.daystat-amount { font-size:20px; font-weight:800; color:var(--text); letter-spacing:-0.5px; line-height:1.1; word-break:break-all; }
.daystat-amount.max { color:var(--green); }
.daystat-amount.min { color:var(--red); }
.daystat-date { font-size:12px; color:var(--text2); font-weight:500; margin-top:3px; }

/* â”€â”€ Progress â”€â”€ */
.progress-wrap { margin-top:9px; }
.prog-label { font-size:11px;font-weight:700;margin-bottom:3px; }
.progress-bar-bg { background:var(--bg);border-radius:4px;height:5px;overflow:hidden;border:1px solid var(--border); }
.progress-bar-fill { height:100%;border-radius:4px;transition:width 1s ease;background:var(--blue); }

/* â”€â”€ Chart Card â”€â”€ */
.chart-card {
  background:var(--surface); border:1px solid var(--border);
  border-radius:11px; padding:16px;
  box-shadow:var(--shadow); margin-bottom:12px;
}
.chart-card-title {
  font-size:11px; font-weight:700; color:var(--muted);
  text-transform:uppercase; letter-spacing:0.4px;
  margin-bottom:14px; display:flex;align-items:center;gap:8px;
}
.chart-card-title::after { content:'';flex:1;height:1px;background:var(--border); }

/* â”€â”€ Channel label â”€â”€ */
.ch-label {
  font-size:10px; color:var(--muted); font-weight:700;
  letter-spacing:0.8px; text-transform:uppercase;
  margin-bottom:9px; display:flex;align-items:center;gap:8px;
}
.ch-label::after { content:'';flex:1;height:1px;background:var(--border); }

/* â”€â”€ Table â”€â”€ */
.data-table { width:100%; border-collapse:collapse; }
.data-table th {
  font-size:10px;color:var(--muted);font-weight:700;
  text-transform:uppercase;letter-spacing:0.4px;
  padding:9px 13px;text-align:left;
  background:var(--surface2);border-bottom:2px solid var(--border);
  white-space:nowrap;
}
.data-table td {
  padding:10px 13px;font-size:12px;
  border-bottom:1px solid var(--border);vertical-align:middle;
}
.data-table tr:hover td { background:#F8FAFC; }
.data-table tr:last-child td { border-bottom:none; }
.rank-badge {
  width:21px;height:21px;border-radius:6px;
  background:var(--bg);border:1px solid var(--border);
  display:inline-flex;align-items:center;justify-content:center;
  font-size:10px;font-weight:800;
}
.rank-badge.gold   { background:#FEF9C3;color:#B45309;border-color:#FDE68A; }
.rank-badge.silver { background:#F1F5F9;color:#475569;border-color:#CBD5E0; }
.rank-badge.bronze { background:#FEF3C7;color:#92400E;border-color:#FDE68A; }

/* â”€â”€ Mini bar â”€â”€ */
.mini-bar-wrap { display:flex;align-items:center;gap:7px; }
.mini-bar-bg { flex:1;height:5px;background:var(--bg);border-radius:3px;overflow:hidden;border:1px solid var(--border); }
.mini-bar-fill { height:100%;border-radius:3px; }

/* â”€â”€ Donut legend â”€â”€ */
.donut-legend { display:flex;flex-direction:column;gap:9px;justify-content:center; }
.legend-item { display:flex;align-items:center;gap:9px;font-size:12px;color:var(--text2); }
.legend-dot { width:9px;height:9px;border-radius:50%;flex-shrink:0; }
.legend-val { font-weight:700;margin-left:auto;font-size:12px;color:var(--text); }

/* â”€â”€ Weekday cards â”€â”€ */
.weekday-card {
  background:var(--surface);border:1px solid var(--border);
  border-radius:9px;padding:11px 7px;text-align:center;
  box-shadow:var(--shadow);transition:all 0.18s;
}
.weekday-card.top { border-color:var(--blue);background:var(--blue-lt); }
.weekday-name { font-size:10px;color:var(--muted);margin-bottom:5px;font-weight:700; }
.weekday-name.top-day { color:var(--blue); }
.weekday-val { font-size:10px;font-weight:700;color:var(--text);word-break:break-all;line-height:1.3; }
.weekday-bar { height:38px;display:flex;align-items:flex-end;justify-content:center;margin:5px 0; }
.weekday-bar-inner { width:16px;border-radius:2px 2px 0 0; }

/* â”€â”€ Category rows â”€â”€ */
.cat-row {
  display:flex;align-items:center;gap:10px;
  padding:10px 0;border-bottom:1px solid var(--border);
}
.cat-row:last-child { border-bottom:none; }
.cat-name { flex:1;font-size:13px;font-weight:500;color:var(--text); }
.cat-val { font-size:12px;font-weight:700;color:var(--text);min-width:130px;text-align:right;word-break:break-all; }
.cat-pct { font-size:11px;color:var(--muted);min-width:42px;text-align:right; }

/* â”€â”€ Subscription Section â”€â”€ */
.sub-header {
  display:flex;align-items:center;gap:10px;
  padding:14px 0 10px;
  border-top:2px solid var(--border);
  margin-top:4px;
}
.sub-header h3 { font-size:14px;font-weight:800;color:var(--text);letter-spacing:-0.3px; }
.sub-badge {
  background:var(--blue);color:#fff;
  border-radius:5px;padding:2px 8px;font-size:10px;font-weight:700;
}
.sub-grid { display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:12px; }
.sub-card {
  background:var(--surface);border:1px solid var(--border);
  border-radius:11px;padding:14px;box-shadow:var(--shadow);
}
.sub-label { font-size:10px;color:var(--muted);font-weight:600;letter-spacing:0.4px;text-transform:uppercase;margin-bottom:6px; }
.sub-value { font-size:18px;font-weight:800;color:var(--text);letter-spacing:-0.4px; }
.sub-value.krw { font-size:15px;font-weight:700; }
.sub-sub { font-size:11px;color:var(--muted);margin-top:5px; }
.status-row { display:flex;gap:8px;margin-top:8px; }
.status-pill {
  display:flex;align-items:center;gap:5px;
  padding:4px 10px;border-radius:20px;font-size:11px;font-weight:700;
}
.status-pill.active { background:var(--green-lt);color:var(--green); }
.status-pill.cancel { background:var(--red-lt);color:var(--red); }
.status-pill::before { content:'';width:6px;height:6px;border-radius:50%;background:currentColor; }

/* â”€â”€ Drop overlay / Toast â”€â”€ */
.drop-overlay {
  display:none;position:fixed;inset:0;
  background:rgba(37,99,235,0.1);backdrop-filter:blur(4px);
  z-index:999;align-items:center;justify-content:center;
}
.drop-overlay.active { display:flex; }
.drop-box {
  background:#fff;border:2px dashed var(--blue);
  border-radius:18px;padding:56px 72px;text-align:center;
}
.drop-box h2 { font-size:20px;color:var(--blue);font-weight:800;margin-top:10px; }
.drop-box p  { color:var(--muted);margin-top:7px;font-size:13px; }
.toast {
  position:fixed;bottom:24px;left:50%;transform:translateX(-50%);
  background:#1E293B;color:#fff;
  padding:11px 22px;border-radius:9px;
  font-size:13px;font-weight:600;
  box-shadow:0 8px 24px rgba(0,0,0,0.18);
  transition:all 0.35s;z-index:9999;opacity:0;pointer-events:none;
  white-space:nowrap;
}
.toast.show { opacity:1; }

@media(max-width:768px){
  .grid-4 { grid-template-columns:repeat(2,1fr); }
  .grid-7 { grid-template-columns:repeat(4,1fr); }
  .sub-grid { grid-template-columns:repeat(2,1fr); }
  .slide,.header,.arrow-nav,.nav-container,.upload-inner { padding-left:14px;padding-right:14px; }
}
</style>
</head>
<body>

<!-- Upload Banner -->
<div class="upload-banner">
  <div class="upload-inner">
    <div class="upload-left">
      <div class="upload-icon">ğŸ“‚</div>
      <div class="upload-text">
        <h3>ì—‘ì…€ ë°ì´í„° ì—°ë™</h3>
        <p>ì œê³µëœ ì—‘ì…€ ì–‘ì‹ì„ ì—…ë¡œë“œí•˜ë©´ ëŒ€ì‹œë³´ë“œê°€ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤</p>
      </div>
    </div>
    <div class="upload-right">
      <div class="upload-status">
        <div class="status-dot" id="statusDot"></div>
        <span id="statusText">ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”</span>
      </div>
      <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17,8 12,3 7,8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ
      </button>
      <button class="upload-btn" id="saveBtn" onclick="saveDataToFirebase()" style="background:rgba(255,255,255,0.15);color:#fff;border:1.5px solid rgba(255,255,255,0.5);" disabled>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17,21 17,13 7,13 7,21"/><polyline points="7,3 7,8 15,8"/></svg>
        ì„œë²„ì— ì €ì¥
      </button>
      <input type="file" id="fileInput" accept=".xlsx,.xls" onchange="handleFile(event)">
    </div>
  </div>
</div>

<!-- Drop Overlay -->
<div class="drop-overlay" id="dropOverlay">
  <div class="drop-box">
    <div style="font-size:44px">ğŸ“Š</div>
    <h2>íŒŒì¼ì„ ì—¬ê¸°ì— ë†“ìœ¼ì„¸ìš”</h2>
    <p>ì—‘ì…€ íŒŒì¼(.xlsx)ì„ ë“œë˜ê·¸ ì•¤ ë“œë¡­í•˜ì—¬ ì—…ë¡œë“œ</p>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- Header -->
<div class="header">
  <div class="header-left">
    <div class="logo-badge">OD</div>
    <div>
      <div class="header-title">OMNI Sales Dashboard</div>
      <div class="header-meta">ì˜´ë‹ˆì±„ë„ í†µí•© ë§¤ì¶œ ë¶„ì„ ì‹œìŠ¤í…œ</div>
    </div>
  </div>
  <div class="header-right">
    <div class="period-selector">
      <label>ì—°ë„</label>
      <select id="selYear">
        <option value="">ì—°ë„</option>
      </select>
      <span class="period-sep">Â·</span>
      <label>ì›”</label>
      <select id="selMonth">
        <option value="">ì›”</option>
      </select>
    </div>
    <div class="period-badge" id="periodBadge">01.01 â€“ 01.31</div>
    <div class="live-dot"></div>
  </div>
</div>

<!-- Nav -->
<div class="nav-container">
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="goTo(0)">ğŸ“Š OMNI ë§¤ì¶œ</button>
    <button class="nav-tab" onclick="goTo(1)">ğŸ›’ D2C ì±„ë„</button>
    <button class="nav-tab" onclick="goTo(2)">ğŸ·ï¸ ìì‚¬ëª° ì¹´í…Œê³ ë¦¬</button>
  </div>
</div>

<!-- Arrow -->
<div class="arrow-nav">
  <button class="arrow-btn" id="prevBtn" onclick="navigate(-1)" disabled>
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="15,18 9,12 15,6"/></svg>ì´ì „
  </button>
  <div class="slide-indicator">
    <div class="dot active" onclick="goTo(0)"></div>
    <div class="dot" onclick="goTo(1)"></div>
    <div class="dot" onclick="goTo(2)"></div>
  </div>
  <button class="arrow-btn" id="nextBtn" onclick="navigate(1)">
    ë‹¤ìŒ<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="9,6 15,12 9,18"/></svg>
  </button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SLIDES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="slides-wrapper">
<div class="slides-track" id="slidesTrack">

<!-- â”€â”€â”€ SLIDE 1 : OMNI â”€â”€â”€ -->
<div class="slide">
  <div class="section-title">
    <div class="section-icon" style="background:var(--blue-lt)">ğŸ“Š</div>
    <div>
      <h2>OMNI ë§¤ì¶œ ëŒ€ì‹œë³´ë“œ</h2>
      <p id="s1-period-label">ì „ì²´ ì±„ë„ í†µí•© ë§¤ì¶œ í˜„í™© Â· 2025ë…„ 1ì›”</p>
    </div>
  </div>

  <!-- ì „ì²´ KPI -->
  <div class="ch-label">ì „ì²´ ë§¤ì¶œ í˜„í™©</div>
  <div class="grid-4">
    <div class="stat-card c-blue">
      <div class="stat-label">ì´ ë§¤ì¶œì•¡</div>
      <div class="stat-value krw" id="s1-total-sales">â€“</div>
      <div class="stat-sub"><span class="tag-up" id="s1-yoy">â€“</span> ì „ë…„ëŒ€ë¹„</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">ëª©í‘œì•¡ / ë‹¬ì„±ìœ¨</div>
      <div class="stat-value krw" id="s1-target">â€“</div>
      <div class="progress-wrap">
        <div class="prog-label" id="s1-achieve">â€“</div>
        <div class="progress-bar-bg"><div class="progress-bar-fill" id="s1-prog" style="width:0%"></div></div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-label">ì¼ í‰ê·  ë§¤ì¶œ</div>
      <div class="stat-value krw" id="s1-daily-avg">â€“</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">ì „ë…„ ë§¤ì¶œ (ë™ê¸°)</div>
      <div class="stat-value krw" id="s1-prev-total">â€“</div>
    </div>
  </div>

  <!-- ìµœê³ /ìµœì € ë§¤ì¶œì¼ -->
  <div class="grid-2">
    <div class="daystat-card">
      <div class="daystat-icon max-icon">ğŸ†</div>
      <div class="daystat-body">
        <div class="daystat-label">ìµœê³  ë§¤ì¶œì¼</div>
        <div class="daystat-amount max" id="s1-max-amount">â€“</div>
        <div class="daystat-date" id="s1-max-day">â€“</div>
      </div>
    </div>
    <div class="daystat-card">
      <div class="daystat-icon min-icon">ğŸ“‰</div>
      <div class="daystat-body">
        <div class="daystat-label">ìµœì € ë§¤ì¶œì¼</div>
        <div class="daystat-amount min" id="s1-min-amount">â€“</div>
        <div class="daystat-date" id="s1-min-day">â€“</div>
      </div>
    </div>
  </div>

  <!-- ì±„ë„ë³„ -->
  <div class="ch-label">ì±„ë„ë³„ ë§¤ì¶œ í˜„í™©</div>
  <div class="grid-2" style="margin-bottom:12px;">
    <div class="chart-card" style="margin-bottom:0">
      <div class="chart-card-title" style="color:var(--blue)">ğŸŒ ì˜¨ë¼ì¸ ì±„ë„</div>
      <div class="grid-2" style="gap:8px;margin-bottom:8px;">
        <div><div class="stat-label">ì´ ë§¤ì¶œì•¡</div><div class="stat-value krw" id="s1-online-total">â€“</div></div>
        <div><div class="stat-label">ëª©í‘œì•¡</div><div class="stat-value krw" id="s1-online-target">â€“</div></div>
        <div><div class="stat-label">ë‹¬ì„±ìœ¨</div><div class="stat-value sm" id="s1-online-ach">â€“</div></div>
        <div><div class="stat-label">ì „ë…„ëŒ€ë¹„</div><div class="stat-value sm" id="s1-online-yoy">â€“</div></div>
      </div>
      <div class="grid-2" style="gap:8px;">
        <div class="daystat-card" style="padding:10px 12px;gap:8px;">
          <div class="daystat-icon max-icon" style="width:30px;height:30px;font-size:14px;">ğŸ†</div>
          <div class="daystat-body">
            <div class="daystat-label">ìµœê³ </div>
            <div class="daystat-amount max xs" id="s1-online-max-amt">â€“</div>
            <div class="daystat-date" id="s1-online-max-day" style="font-size:11px;">â€“</div>
          </div>
        </div>
        <div class="daystat-card" style="padding:10px 12px;gap:8px;">
          <div class="daystat-icon min-icon" style="width:30px;height:30px;font-size:14px;">ğŸ“‰</div>
          <div class="daystat-body">
            <div class="daystat-label">ìµœì €</div>
            <div class="daystat-amount min xs" id="s1-online-min-amt">â€“</div>
            <div class="daystat-date" id="s1-online-min-day" style="font-size:11px;">â€“</div>
          </div>
        </div>
      </div>
    </div>
    <div class="chart-card" style="margin-bottom:0">
      <div class="chart-card-title" style="color:var(--amber)">ğŸª ì˜¤í”„ë¼ì¸ ì±„ë„</div>
      <div class="grid-2" style="gap:8px;margin-bottom:8px;">
        <div><div class="stat-label">ì´ ë§¤ì¶œì•¡</div><div class="stat-value krw" id="s1-offline-total">â€“</div></div>
        <div><div class="stat-label">ëª©í‘œì•¡</div><div class="stat-value krw" id="s1-offline-target">â€“</div></div>
        <div><div class="stat-label">ë‹¬ì„±ìœ¨</div><div class="stat-value sm" id="s1-offline-ach">â€“</div></div>
        <div><div class="stat-label">ì „ë…„ëŒ€ë¹„</div><div class="stat-value sm" id="s1-offline-yoy">â€“</div></div>
      </div>
      <div class="grid-2" style="gap:8px;">
        <div class="daystat-card" style="padding:10px 12px;gap:8px;">
          <div class="daystat-icon max-icon" style="width:30px;height:30px;font-size:14px;">ğŸ†</div>
          <div class="daystat-body">
            <div class="daystat-label">ìµœê³ </div>
            <div class="daystat-amount max xs" id="s1-offline-max-amt">â€“</div>
            <div class="daystat-date" id="s1-offline-max-day" style="font-size:11px;">â€“</div>
          </div>
        </div>
        <div class="daystat-card" style="padding:10px 12px;gap:8px;">
          <div class="daystat-icon min-icon" style="width:30px;height:30px;font-size:14px;">ğŸ“‰</div>
          <div class="daystat-body">
            <div class="daystat-label">ìµœì €</div>
            <div class="daystat-amount min xs" id="s1-offline-min-amt">â€“</div>
            <div class="daystat-date" id="s1-offline-min-day" style="font-size:11px;">â€“</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ì°¨íŠ¸ -->
  <div class="grid-2">
    <div class="chart-card" style="margin-bottom:0">
      <div class="chart-card-title">ì¼ìë³„ ë§¤ì¶œ ì¶”ì´</div>
      <div style="height:185px"><canvas id="dailyChart"></canvas></div>
    </div>
    <div class="chart-card" style="margin-bottom:0">
      <div class="chart-card-title">ì±„ë„ë³„ ë§¤ì¶œ ë¹„ì¤‘</div>
      <div style="display:flex;align-items:center;gap:18px;height:185px;overflow:hidden;">
        <div style="position:relative;width:160px;height:160px;flex-shrink:0;"><canvas id="channelDonut"></canvas></div>
        <div class="donut-legend">
          <div class="legend-item"><div class="legend-dot" style="background:var(--cat1)"></div><span>ì˜¨ë¼ì¸</span><span class="legend-val" id="s1-donut-online">â€“</span></div>
          <div class="legend-item"><div class="legend-dot" style="background:#F59E0B"></div><span>ì˜¤í”„ë¼ì¸</span><span class="legend-val" id="s1-donut-offline">â€“</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ìš”ì¼ë³„ -->
  <div style="height:12px"></div>
  <div class="ch-label">ìš”ì¼ë³„ í‰ê·  ë§¤ì¶œ</div>
  <div style="display:flex;gap:12px;">
    <div class="grid-7" style="flex:2;margin-bottom:0;">
      <div class="weekday-card" id="wd-0"><div class="weekday-name" id="wdn-0">ì›”</div><div class="weekday-bar"><div class="weekday-bar-inner" id="wdb-0" style="background:var(--cat1)"></div></div><div class="weekday-val" id="wdv-0">â€“</div></div>
      <div class="weekday-card" id="wd-1"><div class="weekday-name" id="wdn-1">í™”</div><div class="weekday-bar"><div class="weekday-bar-inner" id="wdb-1" style="background:var(--cat1)"></div></div><div class="weekday-val" id="wdv-1">â€“</div></div>
      <div class="weekday-card" id="wd-2"><div class="weekday-name" id="wdn-2">ìˆ˜</div><div class="weekday-bar"><div class="weekday-bar-inner" id="wdb-2" style="background:var(--cat1)"></div></div><div class="weekday-val" id="wdv-2">â€“</div></div>
      <div class="weekday-card" id="wd-3"><div class="weekday-name" id="wdn-3">ëª©</div><div class="weekday-bar"><div class="weekday-bar-inner" id="wdb-3" style="background:var(--cat1)"></div></div><div class="weekday-val" id="wdv-3">â€“</div></div>
      <div class="weekday-card" id="wd-4"><div class="weekday-name" id="wdn-4">ê¸ˆ</div><div class="weekday-bar"><div class="weekday-bar-inner" id="wdb-4" style="background:var(--cat1)"></div></div><div class="weekday-val" id="wdv-4">â€“</div></div>
      <div class="weekday-card" id="wd-5"><div class="weekday-name" id="wdn-5">í† </div><div class="weekday-bar"><div class="weekday-bar-inner" id="wdb-5" style="background:var(--cat1)"></div></div><div class="weekday-val" id="wdv-5">â€“</div></div>
      <div class="weekday-card" id="wd-6"><div class="weekday-name" id="wdn-6">ì¼</div><div class="weekday-bar"><div class="weekday-bar-inner" id="wdb-6" style="background:var(--cat1)"></div></div><div class="weekday-val" id="wdv-6">â€“</div></div>
    </div>
    <div style="flex:1;display:flex;flex-direction:column;gap:8px;">
      <div class="stat-card" style="flex:1"><div class="stat-label">ì£¼ì¤‘ í‰ê· </div><div class="stat-value krw" id="s1-weekday-avg">â€“</div></div>
      <div class="stat-card" style="flex:1"><div class="stat-label">ì£¼ë§ í‰ê· </div><div class="stat-value krw" id="s1-weekend-avg">â€“</div><div class="stat-sub" id="s1-weekend-diff">â€“</div></div>
      <div class="stat-card c-blue" style="flex:1"><div class="stat-label">ğŸ† ìµœê³  ìš”ì¼</div><div class="stat-value sm hi" id="s1-best-day">â€“</div></div>
    </div>
  </div>
</div>

<!-- â”€â”€â”€ SLIDE 2 : D2C â”€â”€â”€ -->
<div class="slide">
  <div class="section-title">
    <div class="section-icon" style="background:var(--green-lt)">ğŸ›’</div>
    <div>
      <h2>D2C ì±„ë„ ë§¤ì¶œ ëŒ€ì‹œë³´ë“œ</h2>
      <p id="s2-period-label">Direct-to-Consumer ì±„ë„ ì„±ê³¼ ë¶„ì„ Â· 2025ë…„ 1ì›”</p>
    </div>
  </div>

  <div class="ch-label">D2C ì „ì²´ ë§¤ì¶œ í˜„í™©</div>
  <div class="grid-4">
    <div class="stat-card c-blue">
      <div class="stat-label">ì´ ë§¤ì¶œì•¡</div>
      <div class="stat-value krw" id="s2-total">â€“</div>
      <div class="stat-sub"><span class="tag-up" id="s2-yoy">â€“</span> ì „ë…„ëŒ€ë¹„</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">ëª©í‘œ ë‹¬ì„±ìœ¨</div>
      <div class="stat-value sm" id="s2-achieve">â€“</div>
      <div class="progress-wrap"><div class="progress-bar-bg"><div class="progress-bar-fill" id="s2-prog" style="width:0%"></div></div></div>
    </div>
    <div class="stat-card">
      <div class="stat-label">ì¼ í‰ê·  ë§¤ì¶œ</div>
      <div class="stat-value krw" id="s2-daily">â€“</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">ì´ ì£¼ë¬¸ê±´ìˆ˜</div>
      <div class="stat-value sm" id="s2-orders">â€“</div>
      <div class="stat-sub" id="s2-orders-yoy">â€“</div>
    </div>
  </div>
  <div class="grid-2">
    <div class="daystat-card">
      <div class="daystat-icon max-icon">ğŸ†</div>
      <div class="daystat-body">
        <div class="daystat-label">ìµœê³  ë§¤ì¶œì¼</div>
        <div class="daystat-amount max" id="s2-max-amount">â€“</div>
        <div class="daystat-date" id="s2-max-day">â€“</div>
      </div>
    </div>
    <div class="daystat-card">
      <div class="daystat-icon min-icon">ğŸ“‰</div>
      <div class="daystat-body">
        <div class="daystat-label">ìµœì € ë§¤ì¶œì¼</div>
        <div class="daystat-amount min" id="s2-min-amount">â€“</div>
        <div class="daystat-date" id="s2-min-day">â€“</div>
      </div>
    </div>
  </div>

  <div class="ch-label">D2C ì±„ë„ë³„ ë§¤ì¶œ</div>
  <div class="chart-card">
    <div class="chart-card-title">ìì‚¬ëª° / ë„¤ì´ë²„ìŠ¤í† ì–´ / ê¸°íƒ€ ì±„ë„ ë¹„êµ</div>
    <table class="data-table">
      <thead>
        <tr><th>ì±„ë„</th><th>ë§¤ì¶œì•¡</th><th>D2C ë‚´ ë¹„ì¤‘</th><th>ì „ë…„ëŒ€ë¹„</th><th>ìœ ì…ìˆ˜</th><th>ì „í™˜ìœ¨</th></tr>
      </thead>
      <tbody>
        <tr>
          <td><span style="font-weight:700;">ğŸ  ìì‚¬ëª°</span></td>
          <td style="font-weight:700;" id="s2-own-sales">â€“</td>
          <td><div class="mini-bar-wrap"><div class="mini-bar-bg"><div class="mini-bar-fill" id="s2-own-bar" style="background:var(--cat1);width:0%"></div></div><span id="s2-own-pct" style="font-size:12px;font-weight:700;min-width:38px;text-align:right;">â€“</span></div></td>
          <td><span id="s2-own-yoy">â€“</span></td>
          <td id="s2-own-uv">â€“</td>
          <td style="font-weight:700;" id="s2-own-cvr">â€“</td>
        </tr>
        <tr>
          <td><span style="font-weight:700;">N ë„¤ì´ë²„ìŠ¤í† ì–´</span></td>
          <td style="font-weight:700;" id="s2-nav-sales">â€“</td>
          <td><div class="mini-bar-wrap"><div class="mini-bar-bg"><div class="mini-bar-fill" id="s2-nav-bar" style="background:var(--cat3);width:0%"></div></div><span id="s2-nav-pct" style="font-size:12px;font-weight:700;min-width:38px;text-align:right;">â€“</span></div></td>
          <td><span id="s2-nav-yoy">â€“</span></td>
          <td id="s2-nav-uv">â€“</td>
          <td style="font-weight:700;" id="s2-nav-cvr">â€“</td>
        </tr>
        <tr>
          <td><span style="font-weight:700;">ğŸ“¦ ê¸°íƒ€</span></td>
          <td style="font-weight:700;" id="s2-etc-sales">â€“</td>
          <td><div class="mini-bar-wrap"><div class="mini-bar-bg"><div class="mini-bar-fill" id="s2-etc-bar" style="background:var(--muted);width:0%"></div></div><span id="s2-etc-pct" style="font-size:12px;font-weight:700;min-width:38px;text-align:right;">â€“</span></div></td>
          <td><span id="s2-etc-yoy">â€“</span></td>
          <td id="s2-etc-uv">â€“</td>
          <td style="font-weight:700;" id="s2-etc-cvr">â€“</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="ch-label">ìì‚¬ëª° ìœ ì… ë° ì „í™˜ í†µê³„</div>
  <div class="grid-4">
    <div class="stat-card"><div class="stat-label">ì´ ìœ ì…ìˆ˜</div><div class="stat-value sm" id="s2-total-uv">â€“</div></div>
    <div class="stat-card"><div class="stat-label">ì‹ ê·œ ìœ ì…</div><div class="stat-value sm" id="s2-new-uv">â€“</div><div class="stat-sub">ì‹ ê·œ ë¹„ìœ¨ <span id="s2-new-pct">â€“</span></div></div>
    <div class="stat-card"><div class="stat-label">ì¬ë°©ë¬¸</div><div class="stat-value sm" id="s2-return-uv">â€“</div><div class="stat-sub">ì¬ë°©ë¬¸ ë¹„ìœ¨ <span id="s2-return-pct">â€“</span></div></div>
    <div class="stat-card c-blue"><div class="stat-label">ì „í™˜ìœ¨</div><div class="stat-value sm hi" id="s2-cvr">â€“</div></div>
  </div>
  <div class="grid-4">
    <div class="stat-card"><div class="stat-label">ì´ ì£¼ë¬¸ê±´ìˆ˜</div><div class="stat-value sm" id="s2-ord-total">â€“</div></div>
    <div class="stat-card"><div class="stat-label">í‰ê·  ê°ë‹¨ê°€</div><div class="stat-value krw" id="s2-aov">â€“</div></div>
    <div class="stat-card"><div class="stat-label">ì£¼ì¤‘ í‰ê·  ì „í™˜ìœ¨</div><div class="stat-value sm" id="s2-wd-cvr">â€“</div></div>
    <div class="stat-card c-blue"><div class="stat-label">ì£¼ë§ í‰ê·  ì „í™˜ìœ¨</div><div class="stat-value sm hi" id="s2-we-cvr">â€“</div></div>
  </div>

  <div class="chart-card" style="margin-bottom:0">
    <div class="chart-card-title">ì¼ìë³„ ìœ ì… ë° ì „í™˜ìœ¨ í˜„í™©</div>
    <div style="height:195px"><canvas id="d2cChart"></canvas></div>
  </div>
</div>

<!-- â”€â”€â”€ SLIDE 3 : Category â”€â”€â”€ -->
<div class="slide">
  <div class="section-title">
    <div class="section-icon" style="background:var(--amber-lt)">ğŸ·ï¸</div>
    <div>
      <h2>ìì‚¬ëª° ì¹´í…Œê³ ë¦¬ë³„ ëŒ€ì‹œë³´ë“œ</h2>
      <p id="s3-period-label">ì¹´í…Œê³ ë¦¬ Â· ìƒí’ˆ Â· ì •ê¸°ê²°ì œ ì‹¬ì¸µ ë¶„ì„ Â· 2025ë…„ 1ì›”</p>
    </div>
  </div>

  <!-- ë§¤ì¶œ í†µê³„ ìš”ì•½ -->
  <div class="ch-label">ë§¤ì¶œ í†µê³„ ìš”ì•½</div>
  <div class="grid-3">
    <div class="stat-card c-blue">
      <div class="stat-label">ì´ ë§¤ì¶œ</div>
      <div class="stat-value krw" id="s3-total">â€“</div>
      <div class="stat-sub"><span class="tag-up" id="s3-yoy">â€“</span> ì „ë…„ëŒ€ë¹„</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">ì¼ í‰ê·  ë§¤ì¶œ</div>
      <div class="stat-value krw" id="s3-daily">â€“</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">ğŸ† TOP ì¹´í…Œê³ ë¦¬</div>
      <div class="stat-value sm" id="s3-top-cat">â€“</div>
      <div class="stat-sub" id="s3-top-cat-val">â€“</div>
    </div>
  </div>

  <!-- ì¹´í…Œê³ ë¦¬ + TOP5 -->
  <div class="grid-2">
    <div class="chart-card" style="margin-bottom:0">
      <div class="chart-card-title">ì¹´í…Œê³ ë¦¬ë³„ ë§¤ì¶œì•¡ ë° êµ¬ì„±ë¹„</div>
      <div id="catRows"></div>
    </div>
    <div class="chart-card" style="margin-bottom:0">
      <div class="chart-card-title">TOP 5 ë§¤ì¶œ ìƒí’ˆ</div>
      <table class="data-table" id="top5Table">
        <thead><tr><th>ìˆœìœ„</th><th>ìƒí’ˆëª…</th><th>ì¹´í…Œê³ ë¦¬</th><th>ë§¤ì¶œì•¡</th></tr></thead>
        <tbody id="top5Body"></tbody>
      </table>
    </div>
  </div>

  <!-- ì°¨íŠ¸ -->
  <div style="height:12px"></div>
  <div class="grid-2">
    <div class="chart-card" style="margin-bottom:0">
      <div class="chart-card-title">ì¹´í…Œê³ ë¦¬ë³„ ë§¤ì¶œ ë¹„ì¤‘</div>
      <div style="display:flex;align-items:center;gap:16px;height:185px;overflow:hidden;">
        <div style="position:relative;width:160px;height:160px;flex-shrink:0;"><canvas id="catDonut"></canvas></div>
        <div class="donut-legend" id="catLegend"></div>
      </div>
    </div>

<!-- ë³€ê²½ í›„ -->
    <div class="chart-card" style="margin-bottom:0">
      <div class="chart-card-title">ì¹´í…Œê³ ë¦¬ë³„ ìƒí’ˆ ìƒì„¸ ë§¤ì¶œ</div>
      <!-- ì¹´í…Œê³ ë¦¬ íƒ­ -->
      <div id="catTabBar" style="display:flex;gap:4px;margin-bottom:12px;flex-wrap:wrap;"></div>
      <!-- ì¹´í…Œê³ ë¦¬ë³„ ìº”ë²„ìŠ¤ (JSë¡œ show/hide) -->
      <div id="catChartWrap" style="height:185px;position:relative;">
        <canvas id="catBarChart-0" style="position:absolute;inset:0"></canvas>
        <canvas id="catBarChart-1" style="position:absolute;inset:0;display:none"></canvas>
        <canvas id="catBarChart-2" style="position:absolute;inset:0;display:none"></canvas>
        <canvas id="catBarChart-3" style="position:absolute;inset:0;display:none"></canvas>
        <canvas id="catBarChart-4" style="position:absolute;inset:0;display:none"></canvas>
      </div>
    </div>
  </div><!-- grid-2 end -->

  <!-- â•â•â•â• ì •ê¸°ê²°ì œ í˜„í™© â•â•â•â• -->
  <div class="sub-header">
    <div class="section-icon" style="background:#EFF6FF;width:32px;height:32px;font-size:14px;">ğŸ”„</div>
    <h3>ì •ê¸°ê²°ì œ í˜„í™©</h3>
    <span class="sub-badge">Subscription</span>
  </div>

  <!-- â‘  ë§¤ì¶œ í˜„í™© -->
  <div class="ch-label">ë§¤ì¶œ í˜„í™©</div>
  <div class="sub-grid" style="grid-template-columns:repeat(5,1fr)">
    <div class="sub-card">
      <div class="sub-label">ì´ ë§¤ì¶œì•¡</div>
      <div class="sub-value krw" id="sub-total">â€“</div>
    </div>
    <div class="sub-card">
      <div class="sub-label">ì „ì²´ ì‹ ì²­ ê±´ìˆ˜</div>
      <div class="sub-value" id="sub-total-cnt">â€“</div>
    </div>
    <div class="sub-card">
      <div class="sub-label">ì§„í–‰ ê±´ìˆ˜</div>
      <div class="sub-value" style="color:var(--green)" id="sub-active-cnt">â€“</div>
    </div>
    <div class="sub-card">
      <div class="sub-label">í•´ì§€ ê±´ìˆ˜</div>
      <div class="sub-value" style="color:var(--red)" id="sub-cancel-cnt">â€“</div>
    </div>
    <div class="sub-card c-blue">
      <div class="sub-label">êµ¬ë… ìœ ì§€ìœ¨</div>
      <div class="sub-value hi" id="sub-ltr">â€“</div>
    </div>
  </div>

  <!-- â‘¡ ìƒí’ˆ(ì‹ë‹¨)ë³„ í˜„í™© -->
  <div class="ch-label">ì •ê¸°ê²°ì œ ìƒí’ˆë³„ í˜„í™©</div>
  <div class="chart-card">
    <div class="chart-card-title">ì‹ë‹¨ë³„ ë§¤ì¶œ Â· ì§„í–‰ê±´ìˆ˜ Â· í•´ì§€ê±´ìˆ˜ Â· êµ¬ë… ìœ ì§€ìœ¨</div>
    <table class="data-table">
      <thead>
        <tr>
          <th>ìƒí’ˆëª…(ì‹ë‹¨)</th><th>ì¹´í…Œê³ ë¦¬</th>
          <th>ë§¤ì¶œì•¡</th><th>ì „ì²´ ëŒ€ë¹„</th>
          <th>ì§„í–‰ ê±´ìˆ˜</th><th>í•´ì§€ ê±´ìˆ˜</th><th>êµ¬ë… ìœ ì§€ìœ¨</th>
        </tr>
      </thead>
      <tbody id="subProdBody"></tbody>
    </table>
  </div>

  <!-- â‘¢ ë°°ì†¡ íšŸìˆ˜ -->
  <div class="ch-label">ì „ì²´ ë°°ì†¡ íšŸìˆ˜ í˜„í™©</div>
  <div class="grid-2" style="margin-bottom:0">
    <div class="chart-card" style="margin-bottom:0">
      <div class="chart-card-title">ë°°ì†¡ íšŸìˆ˜ë³„ ì‹ ì²­ ê±´ìˆ˜</div>
      <div style="height:160px"><canvas id="deliveryChart"></canvas></div>
    </div>
    <div class="chart-card" style="margin-bottom:0">
      <div class="chart-card-title">ë°°ì†¡ íšŸìˆ˜ë³„ ë¹„ìœ¨</div>
      <table class="data-table">
        <thead><tr><th>êµ¬ë¶„</th><th>ê±´ìˆ˜</th><th>ë¹„ìœ¨</th></tr></thead>
        <tbody id="deliveryBody"></tbody>
      </table>
    </div>
  </div>

</div><!-- slide end -->

</div><!-- slides-track -->
</div><!-- slides-wrapper -->

<script>
// â”€â”€â”€ Slide Nav â”€â”€â”€
let current = 0;
const track = document.getElementById('slidesTrack');
const dots  = document.querySelectorAll('.dot');
const tabs  = document.querySelectorAll('.nav-tab');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');

function goTo(i) {
  current = i;
  track.style.transform = `translateX(-${current * 100}%)`;
  dots.forEach((d,j) => d.classList.toggle('active', j === current));
  tabs.forEach((t,j) => t.classList.toggle('active', j === current));
  prevBtn.disabled = current === 0;
  nextBtn.disabled = current === 2;
  // ìŠ¬ë¼ì´ë“œ ì „í™˜ í›„ ì°¨íŠ¸ í¬ê¸° ì¬ê³„ì‚° (ìˆ¨ê²¨ì§„ ìŠ¬ë¼ì´ë“œì—ì„œ ê·¸ë¦¬ë©´ í¬ê¸° ì˜¤ë¥˜ ë°œìƒ)
  setTimeout(() => {
    Object.values(charts).forEach(c => { try { c.resize(); } catch(e){} });
  }, 460); // transition ì™„ë£Œ í›„
}
function navigate(d) { goTo(Math.max(0, Math.min(2, current + d))); }

// ì°½ í¬ê¸° ë³€ê²½ ì‹œ ëª¨ë“  ì°¨íŠ¸ í¬ê¸° ì¬ê³„ì‚°
window.addEventListener('resize', () => {
  clearTimeout(window._resizeTimer);
  window._resizeTimer = setTimeout(() => {
    Object.values(charts).forEach(c => { try { c.resize(); } catch(e){} });
  }, 200);
});

// â”€â”€â”€ Chart defaults â”€â”€â”€
Chart.defaults.color = '#94A3B8';
Chart.defaults.borderColor = '#E2E8F0';
Chart.defaults.font.family = "'Pretendard', -apple-system, sans-serif";

// â”€â”€â”€ Constants â”€â”€â”€
const WD_KR   = ['ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ','ì¼'];
const WD_FULL = ['ì›”ìš”ì¼','í™”ìš”ì¼','ìˆ˜ìš”ì¼','ëª©ìš”ì¼','ê¸ˆìš”ì¼','í† ìš”ì¼','ì¼ìš”ì¼'];
const CAT_COLORS = ['#2563EB','#0891B2','#059669','#7C3AED','#EA580C'];

// â”€â”€â”€ Formatters â”€â”€â”€
function fmtKRW(v) {
  if (v === null || v === undefined || isNaN(v)) return 'â€“';
  return Math.round(v).toLocaleString('ko-KR') + 'ì›';
}
function fmtNum(v) {
  if (v === null || v === undefined || isNaN(v)) return 'â€“';
  return Math.round(v).toLocaleString('ko-KR');
}
function yoyStr(curr, prev) {
  if (!curr || !prev) return 'â€“';
  const p = ((curr - prev) / prev * 100).toFixed(1);
  return (p >= 0 ? '+' : '') + p + '%';
}
function yoyClass(curr, prev) {
  return curr >= prev ? 'tag-up' : 'tag-down';
}
function daysInMonth(y, m) { return new Date(y, m, 0).getDate(); }
function getDow(dateStr) { const d = new Date(dateStr); return (d.getDay() + 6) % 7; }
function fmtDateLabel(dateStr) {
  if (!dateStr) return 'â€“';
  const d = new Date(dateStr);
  const wd = WD_KR[(d.getDay()+6)%7];
  return `${d.getMonth()+1}ì›” ${d.getDate()}ì¼ (${wd})`;
}

// â”€â”€â”€ State â”€â”€â”€
let DATA = { daily:[], d2c:[], cat:[], products:[], targets:[] };
let YEAR = 2025, MONTH = 1;
let charts = {};

// â”€â”€â”€ Period â”€â”€â”€
function onPeriodChange() {
  const selY = document.getElementById('selYear');
  const selM = document.getElementById('selMonth');

  YEAR  = parseInt(selY.value) || new Date().getFullYear();
  MONTH = parseInt(selM.value) || new Date().getMonth() + 1;

  const days = daysInMonth(YEAR, MONTH);
  const mm   = String(MONTH).padStart(2,'0');
  const dd   = String(days).padStart(2,'0');
  document.getElementById('periodBadge').textContent = `${mm}.01 â€“ ${mm}.${dd}`;

  if (DATA.daily.length > 0) {
    const filterDate = r => { const d = new Date(r.date); return d.getFullYear()==YEAR && d.getMonth()+1==MONTH; };
    renderAll(
      DATA.daily.filter(filterDate),
      DATA.d2c.filter(filterDate),
      DATA.cat.filter(filterDate),
      DATA.products.filter(p => p.year==YEAR && p.month==MONTH)
    );
  } else {
    renderAll([], [], [], []);
  }
}

// â”€â”€â”€ File handling â”€â”€â”€
document.addEventListener('dragover', e => { e.preventDefault(); document.getElementById('dropOverlay').classList.add('active'); });
document.addEventListener('dragleave', e => { if(!e.relatedTarget) document.getElementById('dropOverlay').classList.remove('active'); });
document.addEventListener('drop', e => {
  e.preventDefault();
  document.getElementById('dropOverlay').classList.remove('active');
  if (e.dataTransfer.files[0]) processFile(e.dataTransfer.files[0]);
});
function handleFile(e) { if (e.target.files[0]) processFile(e.target.files[0]); }

function processFile(file) {
  showToast('ğŸ“‚ íŒŒì¼ì„ ì½ëŠ” ì¤‘...');
  const reader = new FileReader();
  reader.onload = evt => {
    try {
      const wb = XLSX.read(evt.target.result, {type:'array', cellDates:true});
      parseWB(wb);
      document.getElementById('statusDot').style.background = '#FBBF24';
      document.getElementById('statusDot').style.boxShadow = '0 0 0 3px rgba(251,191,36,0.3)';
      document.getElementById('statusText').textContent = `ğŸ“‚ ${file.name} ë¡œë“œë¨ â€” [ì„œë²„ì— ì €ì¥] ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”`;
      // ì €ì¥ ë²„íŠ¼ í™œì„±í™”
      const saveBtn = document.getElementById('saveBtn');
      saveBtn.disabled = false;
      saveBtn.style.background = '#fff';
      saveBtn.style.color = 'var(--blue)';
      saveBtn.style.border = 'none';
      showToast('âœ… íŒŒì¼ ë¡œë“œ ì™„ë£Œ! [ì„œë²„ì— ì €ì¥] ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
    } catch(err) { showToast('âŒ íŒŒì¼ ì˜¤ë¥˜: ' + err.message); console.error(err); }
  };
  reader.readAsArrayBuffer(file);
}

// â”€â”€â”€ ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œ Firebaseì— ì €ì¥ â”€â”€â”€
async function saveDataToFirebase() {
  if (!DATA.daily.length) { showToast('âš ï¸ ë¨¼ì € ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.'); return; }
  const saveBtn = document.getElementById('saveBtn');
  saveBtn.innerHTML = 'ì €ì¥ ì¤‘...';
  saveBtn.disabled = true;
  try {
    const months = new Set(DATA.daily.map(r => r.date.slice(0,7)));
    for (const ym of months) {
      const [y, m] = ym.split('-').map(Number);
      const filterYM = r => r.date.startsWith(ym);
      await db.collection('dashboard').doc(ym).set({
        daily:        DATA.daily.filter(filterYM),
        d2c:          DATA.d2c.filter(filterYM),
        cat:          DATA.cat.filter(filterYM),
        products:     DATA.products.filter(p => p.year==y && p.month==m),
        sub:          (DATA.sub?.year==y && DATA.sub?.month==m) ? DATA.sub : null,
        monthTargets: DATA.monthTargets || null,
        updatedAt:    new Date().toISOString(),
      });
    }
    document.getElementById('statusDot').style.background = '#4ADE80';
    document.getElementById('statusDot').style.boxShadow = '0 0 0 3px rgba(74,222,128,0.3)';
    document.getElementById('statusText').textContent = 'â˜ï¸ ì„œë²„ ì €ì¥ ì™„ë£Œ â€” ëª¨ë“  ê¸°ê¸°ì—ì„œ ì¡°íšŒ ê°€ëŠ¥';
    saveBtn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="width:14px;height:14px"><path d="M20 6L9 17l-5-5"/></svg> ì €ì¥ ì™„ë£Œ`;
    saveBtn.style.background = 'rgba(74,222,128,0.25)';
    saveBtn.style.color = '#fff';
    saveBtn.style.border = '1.5px solid rgba(74,222,128,0.6)';
    showToast('â˜ï¸ ì„œë²„ ì €ì¥ ì™„ë£Œ! ë‹¤ë¥¸ PCì—ì„œë„ ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤.');
  } catch(e) {
    showToast('âŒ ì €ì¥ ì‹¤íŒ¨: ' + e.message);
    console.error(e);
    saveBtn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="width:14px;height:14px"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17,21 17,13 7,13 7,21"/></svg> ì„œë²„ì— ì €ì¥`;
    saveBtn.disabled = false;
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PARSER  (ìƒˆ ì—‘ì…€ í˜•ì‹)
//
// ê³µí†µ ì‹œíŠ¸ êµ¬ì¡°:
//   Row 1  : ì‹œíŠ¸ ì œëª©
//   Row 2  : ì›” ëª©í‘œ (C2, D2, E2 ...)
//   Row 3  : ì—°ë„  (Cì—´ë¶€í„° ì—´ ë°©í–¥)
//   Row 4  : ì›”
//   Row 5  : ë‚ ì§œ (YYYY-MM-DD)
//   Row 6  : ìš”ì¼
//   Row 7~ : ì§€í‘œë³„ ì¼ìë³„ ë°ì´í„°
//
// ìƒí’ˆë³„ë§¤ì¶œ ì‹œíŠ¸:
//   B2=ì—°ë„, C2=ì›”
//   Row 3  : í—¤ë”
//   Row 4~ : ìƒí’ˆ ë°ì´í„° (í–‰ ë°©í–¥)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// row / colì€ 0-indexed
function cell(ws, r, c) {
  const cl = ws[XLSX.utils.encode_cell({r, c})];
  return cl || null;
}
function cellV(ws, r, c, def=0) {
  const cl = cell(ws, r, c);
  if (!cl) return def;
  if (typeof cl.v === 'number') return cl.v;
  if (typeof cl.v === 'string') return parseFloat(cl.v) || def;
  return def;
}
function cellS(ws, r, c, def='') {
  const cl = cell(ws, r, c);
  return cl ? String(cl.v||'') : def;
}

function parseWB(wb) {
  // ğŸ“… ì¼ìë³„ë§¤ì¶œ
  // Row7=ì˜¨ë¼ì¸, Row8=ì˜¤í”„ë¼ì¸, Row9=ì „ì²´(formula), Row10=ì „ë…„ì˜¨ë¼ì¸, Row11=ì „ë…„ì˜¤í”„ë¼ì¸, Row12=ì „ë…„ì „ì²´
  // ì›”ëª©í‘œ: C2=ì˜¨ë¼ì¸ëª©í‘œ, D2=ì˜¤í”„ë¼ì¸ëª©í‘œ
  const ws1 = wb.Sheets['ğŸ“… ì¼ìë³„ë§¤ì¶œ'];
  const onlTgt = ws1 ? cellV(ws1, 1, 2) : 0;  // C2 (r=1,c=2)
  const offTgt = ws1 ? cellV(ws1, 1, 3) : 0;  // D2

  // ğŸ›’ D2Cì±„ë„
  // Row7=ìì‚¬ëª°, Row8=ë„¤ì´ë²„, Row9=ê¸°íƒ€, Row10=ìì‚¬ëª°UV, Row11=ìì‚¬ëª°ì£¼ë¬¸, Row12=ì „ë…„ìì‚¬ëª°, Row13=ì „ë…„ë„¤ì´ë²„, Row14=ì „ë…„ê¸°íƒ€
  // ì›”ëª©í‘œ: C2=ìì‚¬ëª°, D2=ë„¤ì´ë²„, E2=ê¸°íƒ€
  const ws2 = wb.Sheets['ğŸ›’ D2Cì±„ë„'];
  const ownTgt = ws2 ? cellV(ws2, 1, 2) : 0;
  const navTgt = ws2 ? cellV(ws2, 1, 3) : 0;
  const etcTgt = ws2 ? cellV(ws2, 1, 4) : 0;

  // ğŸ·ï¸ ì¹´í…Œê³ ë¦¬ë§¤ì¶œ
  // Row7~11=ìŠ¤í‚¨/í—¤ì–´/ë°”ë””/ì„ /ê¸°íƒ€, Row12=í•©ê³„(formula), Row13~17=ì „ë…„
  // ì›”ëª©í‘œ: C2~G2
  const ws3 = wb.Sheets['ğŸ·ï¸ ì¹´í…Œê³ ë¦¬ë§¤ì¶œ'];
  const skinTgt = ws3 ? cellV(ws3, 1, 2) : 0;
  const hairTgt = ws3 ? cellV(ws3, 1, 3) : 0;
  const bodyTgt = ws3 ? cellV(ws3, 1, 4) : 0;
  const sunTgt  = ws3 ? cellV(ws3, 1, 5) : 0;
  const othTgt  = ws3 ? cellV(ws3, 1, 6) : 0;

  // ë‚ ì§œ ëª©ë¡ì€ Row5(r=4)ì—ì„œ ì½ê¸° (Cì—´ë¶€í„° = c=2)
  DATA.daily = parseDataRows(ws1, {
    online:7, offline:8, total:9,
    prevOnline:10, prevOffline:11, prevTotal:12
  });

DATA.d2c = parseDataRows(ws2, {
  ownSales:7, navSales:8, etcSales:9,
  ownUV:10,
  ownNewUV:11,   // ì¶”ê°€
  ownRetUV:12,   // ì¶”ê°€
  ownOrd:13,     // ê¸°ì¡´ 11 â†’ 12
  ownPrev:14, navPrev:15, etcPrev:16  // ê¸°ì¡´ 11~13 â†’ 13~15
});

  DATA.cat = parseDataRows(ws3, {
    skin:7, hair:8, body:9, sun:10, other:11
  });

  DATA.products = parseProdSheet(wb.Sheets['ğŸ“¦ ìƒí’ˆë³„ë§¤ì¶œ']);
  DATA.sub = parseSubSheet(wb.Sheets['ğŸ”„ ì •ê¸°ê²°ì œ']);

  // ëª©í‘œëŠ” ê° ì‹œíŠ¸ Row2ì—ì„œ ì½ì€ ì›” ë‹¨ìœ„ ê°’ì„ DATA.monthTargetsì— ë³´ê´€
  DATA.monthTargets = {
    onlineTarget: onlTgt, offlineTarget: offTgt,
    ownTarget: ownTgt, navTarget: navTgt, etcTarget: etcTgt,
    skinTarget: skinTgt, hairTarget: hairTgt,
    bodyTarget: bodyTgt, sunTarget: sunTgt, otherTarget: othTgt,
  };

  updatePeriodSelector();
  onPeriodChange();
}

// ìƒˆ í•¨ìˆ˜ ì¶”ê°€ (parseWB ì•„ë˜ì—)
function parseSubSheet(ws) {
  if (!ws) return null;
  return {
    year:       cellV(ws, 1, 1),   // B2
    month:      cellV(ws, 1, 2),   // C2
    // â”€â”€ ì„¹ì…˜1: ë§¤ì¶œ í˜„í™© (Row5~9, r=4~8, ë‹¹ì›”=Cì—´c=2, ì „ë…„=Dì—´c=3)
    subTotal:   cellV(ws, 4, 2),   // C5
    prevTotal:  cellV(ws, 4, 3),   // D5
    totalCnt:   cellV(ws, 5, 2),   // C6  ì „ì²´ ì‹ ì²­ê±´ìˆ˜
    activeCnt:  cellV(ws, 6, 2),   // C7  ì§„í–‰ê±´ìˆ˜
    cancelCnt:  cellV(ws, 7, 2),   // C8  í•´ì§€ê±´ìˆ˜
    ltr:        cellV(ws, 8, 2),   // C9  êµ¬ë… ìœ ì§€ìœ¨ (ìë™ê³„ì‚°)
    prevLtr:    cellV(ws, 8, 3),   // D9
    // â”€â”€ ì„¹ì…˜2: ìƒí’ˆë³„ í˜„í™© (Row12~17, r=11~16)
    products: (() => {
      const prods = [];
      for (let r = 11; ; r++) {
        const nm = cellS(ws, r, 0);
        if (!nm) break;
        prods.push({
          name:     nm,
          category: cellS(ws, r, 1),
          sales:    cellV(ws, r, 2),   // Cì—´
          active:   cellV(ws, r, 3),   // Dì—´
          cancel:   cellV(ws, r, 4),   // Eì—´
          ltr:      cellV(ws, r, 5),   // Fì—´ (ìë™ê³„ì‚°)
          prev:     cellV(ws, r, 6),   // Gì—´
        });
      }
      return prods;
    })(),
    // â”€â”€ ì„¹ì…˜3: ë°°ì†¡ íšŸìˆ˜ (Row22~25, r=21~24)
    delivery: (() => {
      const items = [];
      for (let r = 21; ; r++) {
        const label = cellS(ws, r, 0);
        if (!label || label === 'í•©ê³„') break;
        items.push({
          label: label,              // Aì—´: '4íšŒ','8íšŒ'...
          cnt:   cellV(ws, r, 2),   // Cì—´
          ratio: cellV(ws, r, 3),   // Dì—´ (ìë™ê³„ì‚°)
        });
      }
      return items;
    })(),
  };
}

// ì—´ ë°©í–¥ ë‚ ì§œ ì‹œíŠ¸ íŒŒì‹±
// ë‚ ì§œ: Row5 (r=4), col C ì´í›„ (c=2,3,4...)
// ë°ì´í„°í–‰: rowMap = { fieldName: excelRow(1-indexed) }
function parseDataRows(ws, rowMap) {
  if (!ws) return [];
  const rows = [];
  for (let c = 2; ; c++) {  // Cì—´ë¶€í„° (0-indexed c=2)
    const dc = cell(ws, 4, c);  // Row5 (r=4) = ë‚ ì§œí–‰
    if (!dc || !dc.v) break;
    const dateStr = fmtDate(dc.v);
    if (!dateStr || dateStr === 'Invalid Date') break;
    const row = { date: dateStr };
    Object.entries(rowMap).forEach(([key, excelRow]) => {
      row[key] = cellV(ws, excelRow - 1, c);  // excelRowëŠ” 1-indexed â†’ r=excelRow-1
    });
    rows.push(row);
  }
  return rows;
}

// ìƒí’ˆë³„ë§¤ì¶œ: í–‰ ë°©í–¥
// B2=ì—°ë„, C2=ì›”, Row4ë¶€í„° ë°ì´í„°
function parseProdSheet(ws) {
  if (!ws) return [];
  const y = cellV(ws, 1, 1, YEAR);   // B2
  const m = cellV(ws, 1, 2, MONTH);  // C2
  const rows = [];
  for (let r = 3; ; r++) {  // Row4ë¶€í„° (0-indexed r=3)
    const nm = cellS(ws, r, 0);
    if (!nm) break;
    rows.push({
      year: y, month: m,
      name:      nm,
      category:  cellS(ws, r, 1),
      sales:     cellV(ws, r, 2),
      orders:    cellV(ws, r, 3),
      prevSales: cellV(ws, r, 4),
    });
  }
  return rows;
}

// í•´ë‹¹ ì›”ì˜ ëª©í‘œ ê°€ì ¸ì˜¤ê¸° (renderS1/S2 í˜¸í™˜ í˜•ì‹ìœ¼ë¡œ ë°˜í™˜)
function getTargets() {
  if (!DATA.monthTargets) return null;
  const t = DATA.monthTargets;
  return {
    onlineTarget:  t.onlineTarget  || 0,
    offlineTarget: t.offlineTarget || 0,
    d2cTarget:     (t.ownTarget||0) + (t.navTarget||0) + (t.etcTarget||0),
    ownTarget:     t.ownTarget  || 0,
    navTarget:     t.navTarget  || 0,
    etcTarget:     t.etcTarget  || 0,
  };
}

function fmtDate(v) {
  if (v instanceof Date) return v.toISOString().slice(0,10);
  if (typeof v === 'string') return v.slice(0,10);
  if (typeof v === 'number') return new Date((v-25569)*86400*1000).toISOString().slice(0,10);
  return String(v);
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

// â”€â”€â”€ Sample Data ì—†ìŒ â€” ì—‘ì…€ ì—…ë¡œë“œ í›„ í‘œì‹œ â”€â”€â”€

function loadSample() {
  // ìƒ˜í”Œ ë°ì´í„° ì œê±°ë¨. ì—…ë¡œë“œ ì „ ë¹ˆ ìƒíƒœ ìœ ì§€.
  renderAll([], [], [], []);
}

// â”€â”€â”€ Render All â”€â”€â”€
function resetDash() {
  // ë°ì´í„° ì—†ì„ ë•Œ ì „ì²´ â€“ ì´ˆê¸°í™”
  const ids = ['s1-total-sales','s1-yoy','s1-target','s1-achieve','s1-daily-avg','s1-prev-total',
    's1-max-amount','s1-max-day','s1-min-amount','s1-min-day',
    's1-online-total','s1-online-target','s1-online-ach','s1-online-yoy','s1-online-max-amt','s1-online-max-day','s1-online-min-amt','s1-online-min-day',
    's1-offline-total','s1-offline-target','s1-offline-ach','s1-offline-yoy','s1-offline-max-amt','s1-offline-max-day','s1-offline-min-amt','s1-offline-min-day',
    's1-donut-online','s1-donut-offline',
    's2-total','s2-yoy','s2-achieve','s2-daily','s2-orders','s2-orders-yoy',
    's2-max-amount','s2-max-day','s2-min-amount','s2-min-day',
    's2-own-sales','s2-own-pct','s2-own-yoy','s2-own-uv','s2-own-cvr',
    's2-nav-sales','s2-nav-pct','s2-nav-yoy','s2-nav-uv','s2-nav-cvr',
    's2-etc-sales','s2-etc-pct','s2-etc-yoy','s2-etc-uv','s2-etc-cvr',
    's2-total-uv','s2-new-uv','s2-new-pct','s2-return-uv','s2-return-pct','s2-cvr','s2-ord-total','s2-aov','s2-wd-cvr','s2-we-cvr',
    's3-total','s3-yoy','s3-daily','s3-top-cat','s3-top-cat-val',
    'sub-total','sub-total-cnt','sub-active-cnt','sub-cancel-cnt','sub-ltr'];
  ids.forEach(id => set(id, 'â€“'));
  for(let i=0;i<7;i++) { set('wdv-'+i,'â€“'); const b=document.getElementById('wdb-'+i); if(b) b.style.height='0%'; }
  set('s1-weekday-avg','â€“'); set('s1-weekend-avg','â€“'); set('s1-best-day','â€“');
  document.getElementById('s1-prog').style.width = '0%';
  document.getElementById('s2-prog').style.width = '0%';
  ['dailyChart','channelDonut','d2cChart','catDonut','deliveryChart','catBarChart-0','catBarChart-1','catBarChart-2','catBarChart-3','catBarChart-4'].forEach(destroyChart);
  const catRowsEl = document.getElementById('catRows'); if(catRowsEl) catRowsEl.innerHTML='';
  const top5El    = document.getElementById('top5Body'); if(top5El) top5El.innerHTML='<tr><td colspan="4" style="text-align:center;color:var(--muted);padding:20px">ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤</td></tr>';
  const subEl     = document.getElementById('subProdBody'); if(subEl) subEl.innerHTML='<tr><td colspan="7" style="text-align:center;color:var(--muted);padding:20px">ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤</td></tr>';
  const delEl     = document.getElementById('deliveryBody'); if(delEl) delEl.innerHTML='';
}

function renderAll(daily, d2c, cat, products) {
  if (!daily.length && !d2c.length && !cat.length) { resetDash(); return; }
  renderS1(daily);
  renderS2(d2c);
  renderS3(cat, products);
}

// â”€â”€â”€ SLIDE 1 â”€â”€â”€
function renderS1(rows) {
  if (!rows.length) return;

  const sum = key => rows.reduce((s,r) => s+(r[key]||0), 0);
  const totOn  = sum('online'), totOff = sum('offline'), totAll = totOn + totOff;
  const totPrev = sum('prevTotal');
  const onPrev = sum('prevOnline'), offPrev = sum('prevOffline');

  // ì›” ëª©í‘œ (ê° ì‹œíŠ¸ 2í–‰ì—ì„œ ì½ê±°ë‚˜ ìƒ˜í”Œê°’)
  const tgt = getTargets();
  const totTgt = tgt ? (tgt.onlineTarget + tgt.offlineTarget) : 0;
  const onTgt  = tgt ? tgt.onlineTarget  : 0;
  const offTgt = tgt ? tgt.offlineTarget : 0;
  const ach = totTgt > 0 ? totAll/totTgt*100 : 0;

  set('s1-total-sales', fmtKRW(totAll));
  setYoy('s1-yoy', totAll, totPrev);
  set('s1-target', totTgt ? fmtKRW(totTgt) : 'ëª©í‘œ ë¯¸ì…ë ¥');
  set('s1-achieve', totTgt ? 'ë‹¬ì„±ìœ¨ ' + ach.toFixed(1) + '%' : 'â€“');
  document.getElementById('s1-prog').style.width = Math.min(ach,100) + '%';
  set('s1-daily-avg', fmtKRW(totAll / rows.length));
  set('s1-prev-total', fmtKRW(totPrev));

  // Max / Min
  const maxRow = rows.reduce((a,b) => (a.total||0)>(b.total||0)?a:b);
  const minRow = rows.reduce((a,b) => (a.total||0)<(b.total||0)?a:b);
  set('s1-max-amount', fmtKRW(maxRow.total));
  set('s1-max-day',    fmtDateLabel(maxRow.date));
  set('s1-min-amount', fmtKRW(minRow.total));
  set('s1-min-day',    fmtDateLabel(minRow.date));

  // Online channel
  set('s1-online-total',  fmtKRW(totOn));
  set('s1-online-target', onTgt ? fmtKRW(onTgt) : 'â€“');
  set('s1-online-ach',    onTgt>0 ? (totOn/onTgt*100).toFixed(1)+'%' : 'â€“');
  setYoy('s1-online-yoy', totOn, onPrev);
  const maxOn = rows.reduce((a,b) => (a.online||0)>(b.online||0)?a:b);
  const minOn = rows.reduce((a,b) => (a.online||0)<(b.online||0)?a:b);
  set('s1-online-max-amt', fmtKRW(maxOn.online));
  set('s1-online-max-day', fmtDateLabel(maxOn.date));
  set('s1-online-min-amt', fmtKRW(minOn.online));
  set('s1-online-min-day', fmtDateLabel(minOn.date));

  // Offline channel
  set('s1-offline-total',  fmtKRW(totOff));
  set('s1-offline-target', offTgt ? fmtKRW(offTgt) : 'â€“');
  set('s1-offline-ach',    offTgt>0 ? (totOff/offTgt*100).toFixed(1)+'%' : 'â€“');
  setYoy('s1-offline-yoy', totOff, offPrev);
  const maxOff = rows.reduce((a,b) => (a.offline||0)>(b.offline||0)?a:b);
  const minOff = rows.reduce((a,b) => (a.offline||0)<(b.offline||0)?a:b);
  set('s1-offline-max-amt', fmtKRW(maxOff.offline));
  set('s1-offline-max-day', fmtDateLabel(maxOff.date));
  set('s1-offline-min-amt', fmtKRW(minOff.offline));
  set('s1-offline-min-day', fmtDateLabel(minOff.date));

  // Donut
  const onPct  = totAll>0 ? (totOn/totAll*100).toFixed(1) : '0.0';
  const offPct = totAll>0 ? (totOff/totAll*100).toFixed(1) : '0.0';
  set('s1-donut-online',  onPct+'%');
  set('s1-donut-offline', offPct+'%');

  // Weekday
  const wdT=[0,0,0,0,0,0,0], wdC=[0,0,0,0,0,0,0];
  rows.forEach(r => { const wd=getDow(r.date); wdT[wd]+=(r.total||0); wdC[wd]++; });
  const wdA = wdT.map((t,i) => wdC[i]>0?t/wdC[i]:0);
  const maxWd = Math.max(...wdA);
  const bestI = wdA.indexOf(maxWd);
  wdA.forEach((v,i) => {
    set('wdv-'+i, fmtKRW(Math.round(v)));
    const bar = document.getElementById('wdb-'+i);
    if (bar) bar.style.height = (maxWd>0?v/maxWd*100:0)+'%';
    const card = document.getElementById('wd-'+i);
    const nameEl = document.getElementById('wdn-'+i);
    if (card) card.classList.toggle('top', i===bestI);
    if (nameEl) nameEl.classList.toggle('top-day', i===bestI);
  });
  const wdAvgDays  = [0,1,2,3,4].filter(i=>wdC[i]>0);
  const weAvgDays  = [5,6].filter(i=>wdC[i]>0);
  const wdAvg = wdAvgDays.length ? wdAvgDays.reduce((s,i)=>s+wdA[i],0)/wdAvgDays.length : 0;
  const weAvg = weAvgDays.length ? weAvgDays.reduce((s,i)=>s+wdA[i],0)/weAvgDays.length : 0;
  set('s1-weekday-avg', fmtKRW(Math.round(wdAvg)));
  set('s1-weekend-avg', fmtKRW(Math.round(weAvg)));
  const diff = wdAvg>0?(weAvg-wdAvg)/wdAvg*100:0;
  const el = document.getElementById('s1-weekend-diff');
  if(el) { el.textContent = (diff>=0?'+':'')+diff.toFixed(1)+'% vs ì£¼ì¤‘'; el.style.color=diff>=0?'var(--green)':'var(--red)'; }
  set('s1-best-day', WD_FULL[bestI]);

  // Charts
  const labels    = rows.map(r => r.date.slice(5).replace('-','/'));
  const onlineArr = rows.map(r => r.online||0);
  const offlineArr= rows.map(r => r.offline||0);

  destroyChart('dailyChart');
  charts['dailyChart'] = new Chart(document.getElementById('dailyChart'), {
    type:'line',
    data:{ labels, datasets:[
      {label:'ì˜¨ë¼ì¸', data:onlineArr, borderColor:'#2563EB', backgroundColor:'rgba(37,99,235,0.07)', borderWidth:1.5, tension:0.4, fill:true, pointRadius:0},
      {label:'ì˜¤í”„ë¼ì¸', data:offlineArr, borderColor:'#F59E0B', backgroundColor:'rgba(245,158,11,0.05)', borderWidth:1.5, tension:0.4, fill:true, pointRadius:0},
    ]},
    options:{ responsive:true, maintainAspectRatio:false,
      interaction:{mode:'index',intersect:false},
      plugins:{ legend:{display:true,position:'top',labels:{boxWidth:9,font:{size:10}}}, tooltip:{callbacks:{label:ctx=>ctx.dataset.label+': '+fmtKRW(ctx.raw)}} },
      scales:{ x:{ticks:{maxTicksLimit:8,font:{size:10}}}, y:{ticks:{callback:v=>Math.round(v/10000)+'ë§Œ',font:{size:10}}} }
    }
  });

  destroyChart('channelDonut');
  charts['channelDonut'] = new Chart(document.getElementById('channelDonut'), {
    type:'doughnut',
    data:{ labels:['ì˜¨ë¼ì¸','ì˜¤í”„ë¼ì¸'], datasets:[{data:[parseFloat(onPct),parseFloat(offPct)], backgroundColor:['#2563EB','#F59E0B'], borderWidth:0, hoverOffset:3}] },
    options:{ responsive:true, maintainAspectRatio:true, plugins:{ legend:{display:false}, tooltip:{callbacks:{label:ctx=>ctx.label+': '+ctx.raw+'%'}} }, cutout:'72%' }
  });
}

// â”€â”€â”€ SLIDE 2 â”€â”€â”€
function renderS2(rows) {
  if (!rows.length) return;
  const sum = key => rows.reduce((s,r) => s+(r[key]||0), 0);
  const ownT = sum('ownSales'), navT = sum('navSales'), etcT = sum('etcSales');
  const d2cT = ownT + navT + etcT;
  const ownPv = sum('ownPrev'), navPv = sum('navPrev'), etcPv = sum('etcPrev');
  const d2cPv = ownPv + navPv + etcPv;
  // ìì‚¬ëª° ìœ ì…Â·ì£¼ë¬¸ë§Œ ì¡´ì¬
  const ownUV  = sum('ownUV');
  const ownOrd = sum('ownOrd');

  // ì›” ëª©í‘œ (ê° ì‹œíŠ¸ 2í–‰ì—ì„œ ì½ê±°ë‚˜ ìƒ˜í”Œê°’)
  const tgt    = getTargets();
  const d2cTgt = tgt ? tgt.d2cTarget  : 0;
  const ownTgt = tgt ? tgt.ownTarget  : 0;
  const navTgt = tgt ? tgt.navTarget  : 0;
  const etcTgt = tgt ? tgt.etcTarget  : 0;
  const ach = d2cTgt>0?d2cT/d2cTgt*100:0;

  set('s2-total', fmtKRW(d2cT));
  setYoy('s2-yoy', d2cT, d2cPv);
  set('s2-achieve', d2cTgt ? ach.toFixed(1)+'%' : 'â€“');
  document.getElementById('s2-prog').style.width = Math.min(ach,100)+'%';
  set('s2-daily',  fmtKRW(d2cT / rows.length));
  set('s2-orders', fmtNum(ownOrd)+'ê±´');  // ìì‚¬ëª° ì£¼ë¬¸ê±´ìˆ˜ë§Œ
  const el2 = document.getElementById('s2-orders-yoy');
  if(el2) { const p=yoyStr(ownOrd, Math.round(ownOrd*.82)); el2.textContent=p+' ì „ë…„ëŒ€ë¹„'; el2.style.color=ownOrd>=ownOrd*.82?'var(--green)':'var(--red)'; }

  const dayTotals = rows.map(r => ({date:r.date, v:(r.ownSales||0)+(r.navSales||0)+(r.etcSales||0)}));
  const mx = dayTotals.reduce((a,b) => a.v>b.v?a:b);
  const mn = dayTotals.reduce((a,b) => a.v<b.v?a:b);
  set('s2-max-amount', fmtKRW(mx.v));
  set('s2-max-day', fmtDateLabel(mx.date));
  set('s2-min-amount', fmtKRW(mn.v));
  set('s2-min-day', fmtDateLabel(mn.date));

  const ownP = d2cT>0?ownT/d2cT*100:0;
  const navP = d2cT>0?navT/d2cT*100:0;
  const etcP = d2cT>0?etcT/d2cT*100:0;

  set('s2-own-sales', fmtKRW(ownT)); setYoy('s2-own-yoy', ownT, ownPv);
  set('s2-own-pct', ownP.toFixed(1)+'%'); setWidth('s2-own-bar', ownP);
  set('s2-own-uv',  fmtNum(ownUV));
  set('s2-own-cvr', ownUV>0?(ownOrd/ownUV*100).toFixed(1)+'%':'â€“');

  set('s2-nav-sales', fmtKRW(navT)); setYoy('s2-nav-yoy', navT, navPv);
  set('s2-nav-pct', navP.toFixed(1)+'%'); setWidth('s2-nav-bar', navP);
  // ë„¤ì´ë²„Â·ê¸°íƒ€ëŠ” ìœ ì…ìˆ˜Â·ì „í™˜ìœ¨ ì—†ìŒ
  set('s2-nav-uv',  'â€“');
  set('s2-nav-cvr', 'â€“');

  set('s2-etc-sales', fmtKRW(etcT)); setYoy('s2-etc-yoy', etcT, etcPv);
  set('s2-etc-pct', etcP.toFixed(1)+'%'); setWidth('s2-etc-bar', etcP);
  set('s2-etc-uv',  'â€“');
  set('s2-etc-cvr', 'â€“');

const newUV  = sum('ownNewUV');
const retUV  = sum('ownRetUV');
  const cvr = ownUV>0?ownOrd/ownUV*100:0;
  const wdR = rows.filter(r => getDow(r.date)<5);
  const weR = rows.filter(r => getDow(r.date)>=5);
  const wdUV  = wdR.reduce((s,r)=>s+(r.ownUV||0),0);
  const wdOrd = wdR.reduce((s,r)=>s+(r.ownOrd||0),0);
  const weUV  = weR.reduce((s,r)=>s+(r.ownUV||0),0);
  const weOrd = weR.reduce((s,r)=>s+(r.ownOrd||0),0);
  const wdCV = wdUV>0?wdOrd/wdUV*100:0;
  const weCV = weUV>0?weOrd/weUV*100:0;

  set('s2-total-uv', fmtNum(ownUV));
  set('s2-new-uv', fmtNum(newUV)); set('s2-new-pct', (ownUV>0?(newUV/ownUV*100).toFixed(1):0)+'%');
  set('s2-return-uv', fmtNum(retUV)); set('s2-return-pct', (ownUV>0?(retUV/ownUV*100).toFixed(1):0)+'%');
  set('s2-cvr', cvr.toFixed(1)+'%');
  set('s2-ord-total', fmtNum(ownOrd)+'ê±´');
  set('s2-aov', ownOrd>0?fmtKRW(Math.round(ownT/ownOrd)):'â€“');
  set('s2-wd-cvr', wdCV.toFixed(1)+'%');
  set('s2-we-cvr', weCV.toFixed(1)+'%');

  const labels = rows.map(r => r.date.slice(5).replace('-','/'));
  const uvArr  = rows.map(r => r.ownUV||0);
  const cvrArr = rows.map(r => (r.ownUV||0)>0?(r.ownOrd||0)/(r.ownUV||0)*100:0);

  destroyChart('d2cChart');
  charts['d2cChart'] = new Chart(document.getElementById('d2cChart'), {
    type:'bar',
    data:{ labels, datasets:[
      {label:'ìœ ì…ìˆ˜', data:uvArr, backgroundColor:'rgba(37,99,235,0.35)', borderColor:'#2563EB', borderWidth:1, yAxisID:'y', borderRadius:2},
      {label:'ì „í™˜ìœ¨(%)', data:cvrArr, type:'line', borderColor:'#059669', backgroundColor:'transparent', borderWidth:1.5, tension:0.4, pointRadius:0, yAxisID:'y2'}
    ]},
    options:{ responsive:true, maintainAspectRatio:false,
      interaction:{mode:'index',intersect:false},
      plugins:{ legend:{display:true,position:'top',labels:{boxWidth:9,font:{size:10}}},
        tooltip:{callbacks:{label:ctx=>ctx.dataset.label==='ì „í™˜ìœ¨(%)'?ctx.dataset.label+': '+ctx.raw.toFixed(2)+'%':ctx.dataset.label+': '+fmtNum(ctx.raw)}} },
      scales:{ x:{ticks:{maxTicksLimit:8,font:{size:10}}},
        y:{position:'left',ticks:{font:{size:10}}},
        y2:{position:'right',ticks:{callback:v=>v.toFixed(1)+'%',font:{size:10}},grid:{drawOnChartArea:false}} }
    }
  });
}

// â”€â”€â”€ SLIDE 3 â”€â”€â”€
function renderS3(cat, products) {
  if (!cat.length) return;

  const cats = [
    {key:'skin', label:'ìƒˆë²½ë°°ì†¡', color:CAT_COLORS[0]},
    {key:'hair', label:'ê±´ê°•ì¼€ì–´', color:CAT_COLORS[1]},
    {key:'body', label:'ì§ˆí™˜ì¼€ì–´', color:CAT_COLORS[2]},
    {key:'sun',  label:'ë³´ì¶©ì¼€ì–´',   color:CAT_COLORS[3]},
    {key:'other',label:'ì´ë²¤íŠ¸/ê¸°íƒ€',     color:CAT_COLORS[4]},
  ];
  const catT = cats.map(c => ({...c, total:cat.reduce((s,r)=>s+(r[c.key]||0),0)}));
  const grand = catT.reduce((s,c)=>s+c.total,0);
  const days  = cat.length;
  const prev  = grand*.805;

  set('s3-total', fmtKRW(grand));
  setYoy('s3-yoy', grand, prev);
  set('s3-daily', fmtKRW(Math.round(grand/days)));
  const top = catT.reduce((a,b)=>a.total>b.total?a:b);
  set('s3-top-cat', top.label);
  set('s3-top-cat-val', fmtKRW(top.total)+' Â· '+(grand>0?(top.total/grand*100).toFixed(1):0)+'%');

  // Cat rows
  const cr = document.getElementById('catRows'); cr.innerHTML='';
  catT.forEach(c => {
    const pct = grand>0?c.total/grand*100:0;
    cr.innerHTML += `<div class="cat-row">
      <span class="legend-dot" style="background:${c.color}"></span>
      <span class="cat-name">${c.label}</span>
      <div style="flex:1;margin:0 8px"><div class="mini-bar-bg"><div class="mini-bar-fill" style="width:${pct}%;background:${c.color}"></div></div></div>
      <span class="cat-val">${fmtKRW(c.total)}</span>
      <span class="cat-pct">${pct.toFixed(1)}%</span>
    </div>`;
  });

  // TOP5
  const sorted = [...products].sort((a,b)=>b.sales-a.sales).slice(0,5);
  const badges = ['gold','silver','bronze','',''];
  const tbody = document.getElementById('top5Body'); tbody.innerHTML='';
  sorted.forEach((p,i) => {
    tbody.innerHTML += `<tr>
      <td><span class="rank-badge ${badges[i]}">${i+1}</span></td>
      <td style="font-weight:600">${p.name}</td>
      <td style="color:var(--muted);font-size:12px">${p.category}</td>
      <td style="font-weight:700">${fmtKRW(p.sales)}</td>
    </tr>`;
  });
  if(!sorted.length) tbody.innerHTML='<tr><td colspan="4" style="text-align:center;color:var(--muted);padding:20px">ë°ì´í„° ì—†ìŒ</td></tr>';

  // Donut
  destroyChart('catDonut');
  charts['catDonut'] = new Chart(document.getElementById('catDonut'), {
    type:'doughnut',
    data:{ labels:catT.map(c=>c.label), datasets:[{data:catT.map(c=>c.total), backgroundColor:catT.map(c=>c.color), borderWidth:0, hoverOffset:3}] },
    options:{ responsive:true, maintainAspectRatio:true, plugins:{legend:{display:false}, tooltip:{callbacks:{label:ctx=>`${ctx.label}: ${(grand>0?ctx.raw/grand*100:0).toFixed(1)}%`}}}, cutout:'65%' }
  });
  // Legend
  const leg = document.getElementById('catLegend'); leg.innerHTML='';
  catT.forEach(c => {
    const pct=(grand>0?c.total/grand*100:0).toFixed(1);
    leg.innerHTML+=`<div class="legend-item"><div class="legend-dot" style="background:${c.color}"></div><span>${c.label}</span><span class="legend-val">${pct}%</span></div>`;
  });

  // Bar
// âœ… ë³€ê²½ í›„ â€” ì¹´í…Œê³ ë¦¬ë³„ íƒ­ + ê°ê° ë°”ì°¨íŠ¸
// íƒ­ ë²„íŠ¼ ìƒì„±
const tabBar = document.getElementById('catTabBar');
tabBar.innerHTML = '';
catT.forEach((cat, i) => {
  const btn = document.createElement('button');
  btn.textContent = cat.label;
  btn.dataset.idx = i;
  btn.style.cssText = `padding:4px 12px;border-radius:6px;border:1px solid var(--border);
    font-size:11px;font-weight:700;cursor:pointer;font-family:inherit;
    background:${i===0 ? cat.color : 'var(--surface)'};
    color:${i===0 ? '#fff' : 'var(--text2)'};transition:all 0.18s`;
  btn.onclick = () => switchCatTab(i, catT);
  tabBar.appendChild(btn);
});

// ì¹´í…Œê³ ë¦¬ë³„ ì°¨íŠ¸ ë Œë”ë§
catT.forEach((c, i) => {
  const key = 'catBarChart-' + i;
  destroyChart(key);
  const prods = products
    .filter(p => p.category === c.label)
    .sort((a,b) => b.sales - a.sales)
    .slice(0, 8);
  if (!prods.length) return;
  charts[key] = new Chart(document.getElementById(key), {
    type: 'bar',
    data: { labels: prods.map(p => p.name), datasets: [{
      label: 'ë§¤ì¶œì•¡', data: prods.map(p => p.sales),
      backgroundColor: c.color + 'B0', borderRadius: 3, borderSkipped: false
    }]},
    options: { responsive:true, maintainAspectRatio:false, indexAxis:'y',
      plugins:{ legend:{display:false}, tooltip:{callbacks:{label:ctx=>fmtKRW(ctx.raw)}} },
      scales:{ x:{ticks:{callback:v=>Math.round(v/10000)+'ë§Œ',font:{size:10}}},
               y:{ticks:{font:{size:10}}} }
    }
  });
});

// íƒ­ ì „í™˜ í•¨ìˆ˜ (ì „ì—­)
function switchCatTab(idx, catT) {
  for (let i = 0; i < 5; i++) {
    const canvas = document.getElementById('catBarChart-' + i);
    if (canvas) canvas.style.display = i === idx ? 'block' : 'none';
  }
  document.querySelectorAll('#catTabBar button').forEach((btn, i) => {
    const active = i === idx;
    btn.style.background = active ? catT[i].color : 'var(--surface)';
    btn.style.color       = active ? '#fff'        : 'var(--text2)';
    btn.style.borderColor = active ? catT[i].color : 'var(--border)';
  });
}

// â”€â”€ ì •ê¸°ê²°ì œ ë Œë”ë§ â”€â”€
const sub = DATA.sub || null;

// ì„¹ì…˜â‘  ë§¤ì¶œ í˜„í™©
set('sub-total',      sub ? fmtKRW(sub.subTotal)          : 'â€“');
set('sub-total-cnt',  sub ? fmtNum(sub.totalCnt)  + 'ê±´'  : 'â€“');
set('sub-active-cnt', sub ? fmtNum(sub.activeCnt) + 'ê±´'  : 'â€“');
set('sub-cancel-cnt', sub ? fmtNum(sub.cancelCnt) + 'ê±´'  : 'â€“');
set('sub-ltr',        sub ? sub.ltr.toFixed(1)    + '%'   : 'â€“');

// ì„¹ì…˜â‘¡ ìƒí’ˆë³„
const subTotal2 = sub?.subTotal || 0;
const subProds  = sub?.products || [];
const tbody2 = document.getElementById('subProdBody');
tbody2.innerHTML = '';
if (!subProds.length) {
  tbody2.innerHTML = '<tr><td colspan="7" style="text-align:center;color:var(--muted);padding:24px">ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤</td></tr>';
} else {
  subProds.forEach(p => {
    const pct    = subTotal2 > 0 ? (p.sales / subTotal2 * 100).toFixed(1) : '0.0';
    const ltrVal = p.ltr ?? (p.active + p.cancel > 0 ? p.active / (p.active + p.cancel) * 100 : 0);
    tbody2.innerHTML += `<tr>
      <td style="font-weight:600">${p.name}</td>
      <td style="color:var(--muted);font-size:12px">${p.category}</td>
      <td style="font-weight:700">${fmtKRW(p.sales)}</td>
      <td><div class="mini-bar-wrap"><div class="mini-bar-bg"><div class="mini-bar-fill" style="width:${pct}%;background:var(--blue)"></div></div><span style="font-size:11px;font-weight:700;min-width:36px;text-align:right">${pct}%</span></div></td>
      <td style="color:var(--green);font-weight:700">${fmtNum(p.active)}ê±´</td>
      <td style="color:var(--red);font-weight:700">${fmtNum(p.cancel)}ê±´</td>
      <td style="font-weight:700">${ltrVal.toFixed(1)}%</td>
    </tr>`;
  });
}

// ì„¹ì…˜â‘¢ ë°°ì†¡ íšŸìˆ˜
const delivery = sub?.delivery || [];
const tbody3 = document.getElementById('deliveryBody');
tbody3.innerHTML = '';
if (!delivery.length) {
  tbody3.innerHTML = '<tr><td colspan="3" style="text-align:center;color:var(--muted);padding:20px">â€“</td></tr>';
} else {
  delivery.forEach(d => {
    tbody3.innerHTML += `<tr>
      <td style="font-weight:700">${d.label}</td>
      <td style="font-weight:700">${fmtNum(d.cnt)}ê±´</td>
      <td style="font-weight:700">${d.ratio.toFixed(1)}%</td>
    </tr>`;
  });
}

destroyChart('deliveryChart');
if (delivery.length) {
  charts['deliveryChart'] = new Chart(document.getElementById('deliveryChart'), {
    type: 'bar',
    data: {
      labels: delivery.map(d => d.label),
      datasets: [{ label:'ì‹ ì²­ ê±´ìˆ˜', data: delivery.map(d => d.cnt),
        backgroundColor:['#2563EB','#0891B2','#059669','#7C3AED'],
        borderRadius:5, borderSkipped:false }]
    },
    options: { responsive:true, maintainAspectRatio:false,
      plugins:{ legend:{display:false},
        tooltip:{callbacks:{label:ctx=>fmtNum(ctx.raw)+'ê±´ ('+delivery[ctx.dataIndex].ratio.toFixed(1)+'%)'}} },
      scales:{ x:{ticks:{font:{size:12}}}, y:{beginAtZero:true, ticks:{font:{size:10}}} }
    }
  });
}
} // renderS3 end

// â”€â”€â”€ Helpers â”€â”€â”€
function set(id, val) { const el=document.getElementById(id); if(el) el.textContent=val; }
function setWidth(id, pct) { const el=document.getElementById(id); if(el) el.style.width=pct+'%'; }
function destroyChart(id) { if(charts[id]) { charts[id].destroy(); delete charts[id]; } }

function setYoy(id, curr, prev) {
  const el = document.getElementById(id);
  if (!el) return;
  const str = yoyStr(curr, prev);
  el.textContent = str;
  el.className = curr >= prev ? 'tag-up' : 'tag-down';
}

// â”€â”€â”€ Firebase ì„¤ì • â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// âš ï¸ ì•„ë˜ firebaseConfigë¥¼ ë³¸ì¸ì˜ Firebase í”„ë¡œì íŠ¸ ì„¤ì •ìœ¼ë¡œ êµì²´í•˜ì„¸ìš”.
// Firebase ì½˜ì†” > í”„ë¡œì íŠ¸ ì„¤ì • > ì•± > firebaseConfig ë³µì‚¬
const firebaseConfig = {
  apiKey: "AIzaSyAm-Fnz1YKh7OKrPFKjAPO42BwTa3XPnOs",
  authDomain: "sales-dashboard-d4939.firebaseapp.com",
  projectId: "sales-dashboard-d4939",
  storageBucket: "sales-dashboard-d4939.firebasestorage.app",
  messagingSenderId: "996073785958",
  appId: "1:996073785958:web:62ef7dee215121f4ae3ba7"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// â”€â”€â”€ ì—…ë¡œë“œ ë°ì´í„° ê¸°ì¤€ ë…„/ì›” ì…€ë ‰í„° ë™ì  ì—…ë°ì´íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updatePeriodSelector() {
  // ì—…ë¡œë“œëœ ë°ì´í„°ì—ì„œ ì¡´ì¬í•˜ëŠ” ì—°/ì›” ì¡°í•© ì¶”ì¶œ
  const periods = new Set();
  DATA.daily.forEach(r => {
    const d = new Date(r.date);
    periods.add(`${d.getFullYear()}-${d.getMonth()+1}`);
  });

  if (!periods.size) return;

  const years  = [...new Set([...periods].map(p => parseInt(p.split('-')[0])))].sort();
  const selY   = document.getElementById('selYear');
  const selM   = document.getElementById('selMonth');
  const prevY  = selY.value, prevM = selM.value;

  selY.innerHTML = years.map(y => `<option value="${y}">${y}</option>`).join('');

  // ìµœì‹  ì—°ë„ ê¸°ë³¸ ì„ íƒ
  const latestYear = years[years.length - 1];
  selY.value = prevY && years.includes(parseInt(prevY)) ? prevY : latestYear;

  updateMonthSelector([...periods]);

  // ì´ì „ ì„ íƒ ì›” ë³µì› ë˜ëŠ” ìµœì‹  ì›” ì„ íƒ
  if (prevM && selM.querySelector(`option[value="${prevM}"]`)) {
    selM.value = prevM;
  }
}

function updateMonthSelector(periods) {
  const selY = document.getElementById('selYear');
  const selM = document.getElementById('selMonth');
  const curY = parseInt(selY.value);
  const months = periods
    .filter(p => parseInt(p.split('-')[0]) === curY)
    .map(p => parseInt(p.split('-')[1]))
    .sort((a,b)=>a-b);
  selM.innerHTML = months.map(m => `<option value="${m}">${m}ì›”</option>`).join('');
  selM.value = months[months.length - 1]; // ìµœì‹  ì›” ê¸°ë³¸ ì„ íƒ
}

// â”€â”€â”€ ë…„/ì›” ì…€ë ‰í„° ì´ë²¤íŠ¸ (ë‹¨ì¼ ë“±ë¡) â”€â”€â”€
document.getElementById('selYear').addEventListener('change', () => {
  const periods = new Set();
  DATA.daily.forEach(r => {
    const d = new Date(r.date);
    periods.add(`${d.getFullYear()}-${d.getMonth()+1}`);
  });
  if (periods.size) updateMonthSelector([...periods]);
  onPeriodChange();
});
document.getElementById('selMonth').addEventListener('change', onPeriodChange);

// â”€â”€â”€ Firebase ì €ì¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function saveToFirebase(docId, data) {
  try {
    // Firestore 1ë¬¸ì„œ ìµœëŒ€ 1MB â†’ ì›”ë³„ë¡œ ë¶„í•  ì €ì¥
    await db.collection('dashboard').doc(docId).set(data);
    showToast('â˜ï¸ Firebaseì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
  } catch(e) {
    showToast('âŒ Firebase ì €ì¥ ì‹¤íŒ¨: ' + e.message);
    console.error(e);
  }
}

// â”€â”€â”€ Firebase ì „ì²´ ë¡œë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadAllFromFirebase() {
  try {
    showToast('â˜ï¸ ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
    const snap = await db.collection('dashboard').get();
    if (snap.empty) { showToast('â„¹ï¸ ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì—‘ì…€ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.'); return; }

    // ëª¨ë“  ë¬¸ì„œ ë³‘í•©
    DATA.daily    = [];
    DATA.d2c      = [];
    DATA.cat      = [];
    DATA.products = [];
    DATA.sub      = null;
    DATA.monthTargets = null;

    snap.forEach(doc => {
      const d = doc.data();
      if (d.daily)    DATA.daily    = DATA.daily.concat(d.daily);
      if (d.d2c)      DATA.d2c      = DATA.d2c.concat(d.d2c);
      if (d.cat)      DATA.cat      = DATA.cat.concat(d.cat);
      if (d.products) DATA.products = DATA.products.concat(d.products);
      if (d.sub)      DATA.sub      = d.sub;
      if (d.monthTargets) DATA.monthTargets = d.monthTargets;
    });

    if (DATA.daily.length) {
      document.getElementById('statusDot').style.background = '#4ADE80';
      document.getElementById('statusDot').style.boxShadow = '0 0 0 3px rgba(74,222,128,0.3)';
      document.getElementById('statusText').textContent = 'âœ… ì„œë²„ ë°ì´í„° ì—°ë™ë¨';
      updatePeriodSelector();
      onPeriodChange();
      showToast('âœ… ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤');
    } else {
      document.getElementById('statusText').textContent = 'ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”';
      showToast('â„¹ï¸ ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì—‘ì…€ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
    }
  } catch(e) {
    showToast('âŒ Firebase ë¡œë“œ ì‹¤íŒ¨: ' + e.message);
    console.error(e);
  }
}

// â”€â”€â”€ Init â”€â”€â”€
onPeriodChange();
loadAllFromFirebase();
</script>
</body>
</html>
